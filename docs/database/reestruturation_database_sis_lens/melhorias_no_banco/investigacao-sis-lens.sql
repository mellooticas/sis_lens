-- ============================================================================
-- INVESTIGAÇÃO: SIS_LENS (Sistema de Lentes e Laboratórios)
-- ============================================================================
-- Objetivo: Mapear schemas, tabelas e estrutura do banco de lentes
-- Data: 17/01/2026
-- ============================================================================

-- ============================================================================
-- ETAPA 1: LISTAR TODOS OS SCHEMAS
-- ============================================================================
SELECT 
    schema_name,
    schema_owner,
    CASE 
        WHEN schema_name IN ('pg_catalog', 'information_schema') THEN 'Sistema'
        ELSE 'Aplicação'
    END as tipo
FROM information_schema.schemata
WHERE schema_name NOT IN ('pg_toast', 'pg_temp_1', 'pg_toast_temp_1')
ORDER BY 
    CASE WHEN schema_name = 'public' THEN 1 ELSE 2 END,
    schema_name;


    | schema_name        | schema_owner   | tipo      |
| ------------------ | -------------- | --------- |
| public             | postgres       | Aplicação |
| auth               | supabase_admin | Aplicação |
| compras            | postgres       | Aplicação |
| contact_lens       | postgres       | Aplicação |
| core               | postgres       | Aplicação |
| extensions         | postgres       | Aplicação |
| graphql            | supabase_admin | Aplicação |
| graphql_public     | supabase_admin | Aplicação |
| information_schema | supabase_admin | Sistema   |
| lens_catalog       | postgres       | Aplicação |
| pg_catalog         | supabase_admin | Sistema   |
| pg_temp_0          | supabase_admin | Aplicação |
| pg_temp_10         | supabase_admin | Aplicação |
| pg_temp_11         | supabase_admin | Aplicação |
| pg_temp_12         | supabase_admin | Aplicação |
| pg_temp_13         | supabase_admin | Aplicação |
| pg_temp_14         | supabase_admin | Aplicação |
| pg_temp_15         | supabase_admin | Aplicação |
| pg_temp_16         | supabase_admin | Aplicação |
| pg_temp_17         | supabase_admin | Aplicação |
| pg_temp_18         | supabase_admin | Aplicação |
| pg_temp_19         | supabase_admin | Aplicação |
| pg_temp_2          | supabase_admin | Aplicação |
| pg_temp_20         | supabase_admin | Aplicação |
| pg_temp_21         | supabase_admin | Aplicação |
| pg_temp_22         | supabase_admin | Aplicação |
| pg_temp_23         | supabase_admin | Aplicação |
| pg_temp_24         | supabase_admin | Aplicação |
| pg_temp_25         | supabase_admin | Aplicação |
| pg_temp_26         | supabase_admin | Aplicação |
| pg_temp_27         | supabase_admin | Aplicação |
| pg_temp_28         | supabase_admin | Aplicação |
| pg_temp_29         | supabase_admin | Aplicação |
| pg_temp_3          | supabase_admin | Aplicação |
| pg_temp_30         | supabase_admin | Aplicação |
| pg_temp_31         | supabase_admin | Aplicação |
| pg_temp_32         | supabase_admin | Aplicação |
| pg_temp_33         | supabase_admin | Aplicação |
| pg_temp_34         | supabase_admin | Aplicação |
| pg_temp_35         | supabase_admin | Aplicação |
| pg_temp_36         | supabase_admin | Aplicação |
| pg_temp_37         | supabase_admin | Aplicação |
| pg_temp_38         | supabase_admin | Aplicação |
| pg_temp_39         | supabase_admin | Aplicação |
| pg_temp_4          | supabase_admin | Aplicação |
| pg_temp_40         | supabase_admin | Aplicação |
| pg_temp_41         | supabase_admin | Aplicação |
| pg_temp_42         | supabase_admin | Aplicação |
| pg_temp_43         | supabase_admin | Aplicação |
| pg_temp_44         | supabase_admin | Aplicação |
| pg_temp_45         | supabase_admin | Aplicação |
| pg_temp_46         | supabase_admin | Aplicação |
| pg_temp_47         | supabase_admin | Aplicação |
| pg_temp_48         | supabase_admin | Aplicação |
| pg_temp_49         | supabase_admin | Aplicação |
| pg_temp_5          | supabase_admin | Aplicação |
| pg_temp_50         | supabase_admin | Aplicação |
| pg_temp_51         | supabase_admin | Aplicação |
| pg_temp_52         | supabase_admin | Aplicação |
| pg_temp_53         | supabase_admin | Aplicação |
| pg_temp_54         | supabase_admin | Aplicação |
| pg_temp_55         | supabase_admin | Aplicação |
| pg_temp_56         | supabase_admin | Aplicação |
| pg_temp_57         | supabase_admin | Aplicação |
| pg_temp_58         | supabase_admin | Aplicação |
| pg_temp_59         | supabase_admin | Aplicação |
| pg_temp_6          | supabase_admin | Aplicação |
| pg_temp_7          | supabase_admin | Aplicação |
| pg_temp_8          | supabase_admin | Aplicação |
| pg_temp_9          | supabase_admin | Aplicação |
| pg_toast_temp_0    | supabase_admin | Aplicação |
| pg_toast_temp_10   | supabase_admin | Aplicação |
| pg_toast_temp_11   | supabase_admin | Aplicação |
| pg_toast_temp_12   | supabase_admin | Aplicação |
| pg_toast_temp_13   | supabase_admin | Aplicação |
| pg_toast_temp_14   | supabase_admin | Aplicação |
| pg_toast_temp_15   | supabase_admin | Aplicação |
| pg_toast_temp_16   | supabase_admin | Aplicação |
| pg_toast_temp_17   | supabase_admin | Aplicação |
| pg_toast_temp_18   | supabase_admin | Aplicação |
| pg_toast_temp_19   | supabase_admin | Aplicação |
| pg_toast_temp_2    | supabase_admin | Aplicação |
| pg_toast_temp_20   | supabase_admin | Aplicação |
| pg_toast_temp_21   | supabase_admin | Aplicação |
| pg_toast_temp_22   | supabase_admin | Aplicação |
| pg_toast_temp_23   | supabase_admin | Aplicação |
| pg_toast_temp_24   | supabase_admin | Aplicação |
| pg_toast_temp_25   | supabase_admin | Aplicação |
| pg_toast_temp_26   | supabase_admin | Aplicação |
| pg_toast_temp_27   | supabase_admin | Aplicação |
| pg_toast_temp_28   | supabase_admin | Aplicação |
| pg_toast_temp_29   | supabase_admin | Aplicação |
| pg_toast_temp_3    | supabase_admin | Aplicação |
| pg_toast_temp_30   | supabase_admin | Aplicação |
| pg_toast_temp_31   | supabase_admin | Aplicação |
| pg_toast_temp_32   | supabase_admin | Aplicação |
| pg_toast_temp_33   | supabase_admin | Aplicação |
| pg_toast_temp_34   | supabase_admin | Aplicação |
| pg_toast_temp_35   | supabase_admin | Aplicação |
| pg_toast_temp_36   | supabase_admin | Aplicação |


-- ============================================================================
-- ETAPA 2: LISTAR TODAS AS TABELAS POR SCHEMA
-- ============================================================================
SELECT 
    table_schema as schema,
    table_name as tabela,
    table_type as tipo,
    (SELECT COUNT(*) 
     FROM information_schema.columns c 
     WHERE c.table_schema = t.table_schema 
     AND c.table_name = t.table_name) as total_colunas
FROM information_schema.tables t
WHERE table_schema NOT IN ('pg_catalog', 'information_schema')
ORDER BY 
    table_schema,
    CASE table_type 
        WHEN 'BASE TABLE' THEN 1
        WHEN 'VIEW' THEN 2
        ELSE 3
    END,
    table_name;

| schema       | tabela                           | tipo       | total_colunas |
| ------------ | -------------------------------- | ---------- | ------------- |
| auth         | audit_log_entries                | BASE TABLE | 5             |
| auth         | flow_state                       | BASE TABLE | 12            |
| auth         | identities                       | BASE TABLE | 9             |
| auth         | instances                        | BASE TABLE | 5             |
| auth         | mfa_amr_claims                   | BASE TABLE | 5             |
| auth         | mfa_challenges                   | BASE TABLE | 7             |
| auth         | mfa_factors                      | BASE TABLE | 13            |
| auth         | oauth_authorizations             | BASE TABLE | 17            |
| auth         | oauth_client_states              | BASE TABLE | 4             |
| auth         | oauth_clients                    | BASE TABLE | 12            |
| auth         | oauth_consents                   | BASE TABLE | 6             |
| auth         | one_time_tokens                  | BASE TABLE | 7             |
| auth         | refresh_tokens                   | BASE TABLE | 9             |
| auth         | saml_providers                   | BASE TABLE | 9             |
| auth         | saml_relay_states                | BASE TABLE | 8             |
| auth         | schema_migrations                | BASE TABLE | 1             |
| auth         | sessions                         | BASE TABLE | 15            |
| auth         | sso_domains                      | BASE TABLE | 5             |
| auth         | sso_providers                    | BASE TABLE | 5             |
| auth         | users                            | BASE TABLE | 35            |
| compras      | estoque_movimentacoes            | BASE TABLE | 16            |
| compras      | estoque_saldo                    | BASE TABLE | 11            |
| compras      | historico_precos                 | BASE TABLE | 11            |
| compras      | pedido_itens                     | BASE TABLE | 11            |
| compras      | pedidos                          | BASE TABLE | 18            |
| compras      | v_estoque_alertas                | VIEW       | 12            |
| compras      | v_itens_pendentes                | VIEW       | 11            |
| compras      | v_pedidos_completos              | VIEW       | 23            |
| core         | fornecedores                     | BASE TABLE | 17            |
| extensions   | pg_stat_statements               | VIEW       | 49            |
| extensions   | pg_stat_statements_info          | VIEW       | 2             |
| lens_catalog | grupos_canonicos                 | BASE TABLE | 34            |
| lens_catalog | grupos_canonicos_backup_old      | BASE TABLE | 21            |
| lens_catalog | grupos_canonicos_log             | BASE TABLE | 9             |
| lens_catalog | lentes                           | BASE TABLE | 86            |
| lens_catalog | lentes_canonicas                 | BASE TABLE | 24            |
| lens_catalog | lentes_grupos_backup_old         | BASE TABLE | 3             |
| lens_catalog | marcas                           | BASE TABLE | 10            |
| lens_catalog | premium_canonicas                | BASE TABLE | 26            |
| lens_catalog | stg_lentes_import                | BASE TABLE | 27            |
| lens_catalog | v_grupos_canonicos_detalhados    | VIEW       | 23            |
| lens_catalog | v_grupos_canonicos_detalhados_v5 | VIEW       | 28            |
| public       | v_estatisticas_catalogo          | VIEW       | 15            |
| public       | v_estoque_disponivel             | VIEW       | 14            |
| public       | v_filtros_disponiveis            | VIEW       | 5             |
| public       | v_filtros_grupos_canonicos       | VIEW       | 7             |
| public       | v_fornecedores_catalogo          | VIEW       | 18            |
| public       | v_fornecedores_por_lente         | VIEW       | 17            |
| public       | v_grupos_canonicos               | VIEW       | 26            |
| public       | v_grupos_canonicos_completos     | VIEW       | 9             |
| public       | v_grupos_com_lentes              | VIEW       | 10            |
| public       | v_grupos_melhor_margem           | VIEW       | 28            |
| public       | v_grupos_por_faixa_preco         | VIEW       | 22            |
| public       | v_grupos_por_receita_cliente     | VIEW       | 28            |
| public       | v_grupos_premium                 | VIEW       | 28            |
| public       | v_lentes_busca                   | VIEW       | 16            |
| public       | v_lentes_catalogo                | VIEW       | 46            |
| public       | v_lentes_cotacao_compra          | VIEW       | 16            |
| public       | v_pedidos_pendentes              | VIEW       | 13            |
| public       | v_sugestoes_upgrade              | VIEW       | 16            |
| public       | vw_bi_lentes_lucratividade       | VIEW       | 5             |
| public       | vw_canonicas_genericas           | VIEW       | 27            |
| public       | vw_canonicas_premium             | VIEW       | 30            |
| public       | vw_detalhes_premium              | VIEW       | 48            |
| public       | vw_lentes_catalogo               | VIEW       | 60            |
| public       | vw_stats_catalogo                | VIEW       | 47            |
| realtime     | messages                         | BASE TABLE | 8             |
| realtime     | schema_migrations                | BASE TABLE | 2             |
| realtime     | subscription                     | BASE TABLE | 7             |
| storage      | buckets                          | BASE TABLE | 11            |
| storage      | buckets_analytics                | BASE TABLE | 7             |
| storage      | buckets_vectors                  | BASE TABLE | 4             |
| storage      | migrations                       | BASE TABLE | 4             |
| storage      | objects                          | BASE TABLE | 13            |
| storage      | prefixes                         | BASE TABLE | 5             |
| storage      | s3_multipart_uploads             | BASE TABLE | 9             |
| storage      | s3_multipart_uploads_parts       | BASE TABLE | 10            |
| storage      | vector_indexes                   | BASE TABLE | 9             |
| vault        | secrets                          | BASE TABLE | 8             |
| vault        | decrypted_secrets                | VIEW       | 9             |


-- ============================================================================
-- ETAPA 3: ESTRUTURA DETALHADA - TABELAS PRINCIPAIS
-- ============================================================================
-- Baseado na ETAPA 2, as tabelas corretas são:
-- - lens_catalog.lentes (86 colunas)
-- - core.fornecedores (17 colunas)

-- Estrutura de LENTES
SELECT 
    column_name as coluna,
    data_type as tipo,
    character_maximum_length as tamanho,
    is_nullable as aceita_null,
    column_default as valor_padrao
FROM information_schema.columns
WHERE table_schema = 'lens_catalog'
AND table_name = 'lentes'
ORDER BY ordinal_position;

| coluna                    | tipo                     | tamanho | aceita_null | valor_padrao                           |
| ------------------------- | ------------------------ | ------- | ----------- | -------------------------------------- |
| id                        | uuid                     | null    | NO          | gen_random_uuid()                      |
| fornecedor_id             | uuid                     | null    | NO          | null                                   |
| marca_id                  | uuid                     | null    | YES         | null                                   |
| grupo_canonico_id         | uuid                     | null    | YES         | null                                   |
| nome_lente                | text                     | null    | NO          | null                                   |
| nome_canonizado           | text                     | null    | YES         | null                                   |
| slug                      | text                     | null    | YES         | null                                   |
| sku                       | character varying        | 100     | YES         | null                                   |
| codigo_fornecedor         | character varying        | 100     | YES         | null                                   |
| tipo_lente                | USER-DEFINED             | null    | NO          | null                                   |
| material                  | USER-DEFINED             | null    | NO          | null                                   |
| indice_refracao           | USER-DEFINED             | null    | NO          | null                                   |
| categoria                 | USER-DEFINED             | null    | NO          | null                                   |
| tratamento_antirreflexo   | boolean                  | null    | NO          | false                                  |
| tratamento_antirrisco     | boolean                  | null    | NO          | false                                  |
| tratamento_uv             | boolean                  | null    | NO          | false                                  |
| tratamento_blue_light     | boolean                  | null    | NO          | false                                  |
| tratamento_fotossensiveis | USER-DEFINED             | null    | YES         | 'nenhum'::lens_catalog.tratamento_foto |
| diametro_mm               | integer                  | null    | YES         | null                                   |
| curva_base                | numeric                  | null    | YES         | null                                   |
| espessura_centro_mm       | numeric                  | null    | YES         | null                                   |
| eixo_optico               | character varying        | 50      | YES         | null                                   |
| grau_esferico_min         | numeric                  | null    | YES         | null                                   |
| grau_esferico_max         | numeric                  | null    | YES         | null                                   |
| grau_cilindrico_min       | numeric                  | null    | YES         | null                                   |
| grau_cilindrico_max       | numeric                  | null    | YES         | null                                   |
| adicao_min                | numeric                  | null    | YES         | null                                   |
| adicao_max                | numeric                  | null    | YES         | null                                   |
| preco_custo               | numeric                  | null    | NO          | 0                                      |
| preco_venda_sugerido      | numeric                  | null    | NO          | 0                                      |
| margem_lucro              | numeric                  | null    | YES         | null                                   |
| estoque_disponivel        | integer                  | null    | YES         | 0                                      |
| estoque_minimo            | integer                  | null    | YES         | 0                                      |
| lead_time_dias            | integer                  | null    | YES         | null                                   |
| status                    | USER-DEFINED             | null    | NO          | 'ativo'::lens_catalog.status_lente     |
| ativo                     | boolean                  | null    | NO          | true                                   |
| peso                      | integer                  | null    | YES         | 50                                     |
| metadata                  | jsonb                    | null    | YES         | '{}'::jsonb                            |
| created_at                | timestamp with time zone | null    | NO          | now()                                  |
| updated_at                | timestamp with time zone | null    | NO          | now()                                  |
| deleted_at                | timestamp with time zone | null    | YES         | null                                   |
| sku_fornecedor            | character varying        | null    | YES         | null                                   |
| codigo_original           | character varying        | null    | YES         | null                                   |
| nome_comercial            | text                     | null    | YES         | null                                   |
| descricao_curta           | text                     | null    | YES         | null                                   |
| linha_produto             | character varying        | null    | YES         | null                                   |
| custo_base                | numeric                  | null    | YES         | 0                                      |
| preco_tabela              | numeric                  | null    | YES         | 0                                      |
| preco_fabricante          | numeric                  | null    | YES         | null                                   |
| esferico_min              | numeric                  | null    | YES         | null                                   |
| esferico_max              | numeric                  | null    | YES         | null                                   |
| cilindrico_min            | numeric                  | null    | YES         | null                                   |
| cilindrico_max            | numeric                  | null    | YES         | null                                   |
| dnp_min                   | integer                  | null    | YES         | null                                   |
| dnp_max                   | integer                  | null    | YES         | null                                   |
| prazo_entrega             | integer                  | null    | YES         | 7                                      |
| obs_prazo                 | text                     | null    | YES         | null                                   |
| peso_frete                | numeric                  | null    | YES         | 50.0                                   |
| exige_receita_especial    | boolean                  | null    | YES         | false                                  |
| disponivel                | boolean                  | null    | YES         | true                                   |
| lente_canonica_id         | uuid                     | null    | YES         | null                                   |
| premium_canonica_id       | uuid                     | null    | YES         | null                                   |
| diametro                  | integer                  | null    | YES         | null                                   |
| espessura_central         | numeric                  | null    | YES         | null                                   |
| peso_aproximado           | numeric                  | null    | YES         | null                                   |
| ar                        | boolean                  | null    | YES         | false                                  |
| antirrisco                | boolean                  | null    | YES         | false                                  |
| hidrofobico               | boolean                  | null    | YES         | false                                  |
| antiembaçante             | boolean                  | null    | YES         | false                                  |
| blue                      | boolean                  | null    | YES         | false                                  |
| uv400                     | boolean                  | null    | YES         | false                                  |
| polarizado                | boolean                  | null    | YES         | false                                  |
| digital                   | boolean                  | null    | YES         | false                                  |
| free_form                 | boolean                  | null    | YES         | false                                  |
| indoor                    | boolean                  | null    | YES         | false                                  |
| drive                     | boolean                  | null    | YES         | false                                  |
| fotossensivel             | text                     | null    | YES         | 'nenhum'::text                         |
| destaque                  | boolean                  | null    | YES         | false                                  |
| novidade                  | boolean                  | null    | YES         | false                                  |
| data_lancamento           | date                     | null    | YES         | null                                   |
| data_descontinuacao       | date                     | null    | YES         | null                                   |
| descricao_completa        | text                     | null    | YES         | null                                   |
| contraindicacoes          | text                     | null    | YES         | null                                   |
| observacoes               | text                     | null    | YES         | null                                   |
| beneficios                | ARRAY                    | null    | YES         | null                                   |
| indicacoes                | ARRAY                    | null    | YES         | null                                   |

-- Estrutura de FORNECEDORES (laboratorios)
SELECT 
    column_name as coluna,
    data_type as tipo,
    character_maximum_length as tamanho,
    is_nullable as aceita_null,
    column_default as valor_padrao
FROM information_schema.columns
WHERE table_schema = 'core'
AND table_name = 'fornecedores'
ORDER BY ordinal_position;

| coluna              | tipo                     | tamanho | aceita_null | valor_padrao                                                                            |
| ------------------- | ------------------------ | ------- | ----------- | --------------------------------------------------------------------------------------- |
| id                  | uuid                     | null    | NO          | gen_random_uuid()                                                                       |
| nome                | text                     | null    | NO          | null                                                                                    |
| razao_social        | text                     | null    | YES         | null                                                                                    |
| cnpj                | character varying        | 18      | YES         | null                                                                                    |
| cep_origem          | character varying        | 9       | YES         | null                                                                                    |
| cidade_origem       | text                     | null    | YES         | null                                                                                    |
| estado_origem       | character varying        | 2       | YES         | null                                                                                    |
| prazo_visao_simples | integer                  | null    | YES         | 7                                                                                       |
| prazo_multifocal    | integer                  | null    | YES         | 10                                                                                      |
| prazo_surfacada     | integer                  | null    | YES         | 12                                                                                      |
| prazo_free_form     | integer                  | null    | YES         | 15                                                                                      |
| frete_config        | jsonb                    | null    | YES         | '{"tipo": "PAC", "taxa_fixa": 25, "valor_minimo": 0, "frete_gratis_acima": 500}'::jsonb |
| desconto_volume     | jsonb                    | null    | YES         | '{"5_unidades": 0.03, "10_unidades": 0.05, "20_unidades": 0.08}'::jsonb                 |
| ativo               | boolean                  | null    | NO          | true                                                                                    |
| created_at          | timestamp with time zone | null    | NO          | now()                                                                                   |
| updated_at          | timestamp with time zone | null    | NO          | now()                                                                                   |
| deleted_at          | timestamp with time zone | null    | YES         | null                                                                                    |


-- Estrutura de MARCAS (relacionado às lentes)
SELECT 
    column_name as coluna,
    data_type as tipo,
    character_maximum_length as tamanho,
    is_nullable as aceita_null,
    column_default as valor_padrao
FROM information_schema.columns
WHERE table_schema = 'lens_catalog'
AND table_name = 'marcas'
ORDER BY ordinal_position;


| coluna     | tipo                     | tamanho | aceita_null | valor_padrao      |
| ---------- | ------------------------ | ------- | ----------- | ----------------- |
| id         | uuid                     | null    | NO          | gen_random_uuid() |
| nome       | character varying        | 100     | NO          | null              |
| slug       | character varying        | 100     | NO          | null              |
| is_premium | boolean                  | null    | NO          | false             |
| descricao  | text                     | null    | YES         | null              |
| website    | text                     | null    | YES         | null              |
| logo_url   | text                     | null    | YES         | null              |
| ativo      | boolean                  | null    | NO          | true              |
| created_at | timestamp with time zone | null    | NO          | now()             |
| updated_at | timestamp with time zone | null    | NO          | now()             |


-- Estrutura de GRUPOS_CANONICOS (relacionado às lentes)
SELECT 
    column_name as coluna,
    data_type as tipo,
    character_maximum_length as tamanho,
    is_nullable as aceita_null,
    column_default as valor_padrao
FROM information_schema.columns
WHERE table_schema = 'lens_catalog'
AND table_name = 'grupos_canonicos'
ORDER BY ordinal_position;


| coluna                    | tipo                     | tamanho | aceita_null | valor_padrao                           |
| ------------------------- | ------------------------ | ------- | ----------- | -------------------------------------- |
| id                        | uuid                     | null    | NO          | gen_random_uuid()                      |
| nome_grupo                | text                     | null    | NO          | null                                   |
| slug                      | text                     | null    | NO          | null                                   |
| tipo_lente                | USER-DEFINED             | null    | NO          | null                                   |
| material                  | USER-DEFINED             | null    | NO          | null                                   |
| indice_refracao           | USER-DEFINED             | null    | NO          | null                                   |
| categoria_predominante    | USER-DEFINED             | null    | YES         | null                                   |
| tem_antirreflexo          | boolean                  | null    | NO          | false                                  |
| tem_antirrisco            | boolean                  | null    | NO          | false                                  |
| tem_uv                    | boolean                  | null    | NO          | false                                  |
| tem_blue_light            | boolean                  | null    | NO          | false                                  |
| tratamento_foto           | USER-DEFINED             | null    | YES         | 'nenhum'::lens_catalog.tratamento_foto |
| total_lentes              | integer                  | null    | YES         | 0                                      |
| preco_medio               | numeric                  | null    | YES         | null                                   |
| preco_minimo              | numeric                  | null    | YES         | null                                   |
| preco_maximo              | numeric                  | null    | YES         | null                                   |
| is_premium                | boolean                  | null    | NO          | false                                  |
| peso                      | integer                  | null    | YES         | 50                                     |
| ativo                     | boolean                  | null    | NO          | true                                   |
| created_at                | timestamp with time zone | null    | NO          | now()                                  |
| updated_at                | timestamp with time zone | null    | NO          | now()                                  |
| grau_esferico_min         | numeric                  | null    | YES         | null                                   |
| grau_esferico_max         | numeric                  | null    | YES         | null                                   |
| grau_cilindrico_min       | numeric                  | null    | YES         | null                                   |
| grau_cilindrico_max       | numeric                  | null    | YES         | null                                   |
| adicao_min                | numeric                  | null    | YES         | null                                   |
| adicao_max                | numeric                  | null    | YES         | null                                   |
| descricao_ranges          | text                     | null    | YES         | null                                   |
| total_marcas              | integer                  | null    | YES         | 0                                      |
| tratamento_antirreflexo   | boolean                  | null    | YES         | false                                  |
| tratamento_antirrisco     | boolean                  | null    | YES         | false                                  |
| tratamento_uv             | boolean                  | null    | YES         | false                                  |
| tratamento_blue_light     | boolean                  | null    | YES         | false                                  |
| tratamento_fotossensiveis | text                     | null    | YES         | null                                   |


-- ============================================================================
-- ETAPA 4: RELACIONAMENTOS (FOREIGN KEYS)
-- ============================================================================
SELECT
    tc.table_schema as schema_origem,
    tc.table_name as tabela_origem,
    kcu.column_name as coluna_origem,
    ccu.table_schema as schema_destino,
    ccu.table_name as tabela_destino,
    ccu.column_name as coluna_destino,
    tc.constraint_name as nome_constraint
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kcu
    ON tc.constraint_name = kcu.constraint_name
    AND tc.table_schema = kcu.table_schema
JOIN information_schema.constraint_column_usage ccu
    ON ccu.constraint_name = tc.constraint_name
    AND ccu.table_schema = tc.table_schema
WHERE tc.constraint_type = 'FOREIGN KEY'
AND tc.table_schema NOT IN ('pg_catalog', 'information_schema')
ORDER BY tc.table_schema, tc.table_name;

| schema_origem | tabela_origem         | coluna_origem     | schema_destino | tabela_destino   | coluna_destino | nome_constraint                           |
| ------------- | --------------------- | ----------------- | -------------- | ---------------- | -------------- | ----------------------------------------- |
| compras       | estoque_movimentacoes | pedido_item_id    | compras        | pedido_itens     | id             | estoque_movimentacoes_pedido_item_id_fkey |
| compras       | estoque_movimentacoes | pedido_id         | compras        | pedidos          | id             | estoque_movimentacoes_pedido_id_fkey      |
| compras       | historico_precos      | pedido_id         | compras        | pedidos          | id             | historico_precos_pedido_id_fkey           |
| compras       | pedido_itens          | pedido_id         | compras        | pedidos          | id             | pedido_itens_pedido_id_fkey               |
| lens_catalog  | lentes                | marca_id          | lens_catalog   | marcas           | id             | lentes_marca_id_fkey                      |
| lens_catalog  | lentes                | grupo_canonico_id | lens_catalog   | grupos_canonicos | id             | lentes_grupo_canonico_id_fkey             |
| lens_catalog  | premium_canonicas     | marca_id          | lens_catalog   | marcas           | id             | premium_canonicas_marca_id_fkey           |


-- ============================================================================
-- ETAPA 5: CONTAGEM DE REGISTROS
-- ============================================================================
-- Schemas e tabelas corretas identificadas nas ETAPAs anteriores
SELECT 'lens_catalog.lentes' as tabela, COUNT(*) as total FROM lens_catalog.lentes
UNION ALL
SELECT 'lens_catalog.marcas' as tabela, COUNT(*) as total FROM lens_catalog.marcas
UNION ALL
SELECT 'lens_catalog.grupos_canonicos' as tabela, COUNT(*) as total FROM lens_catalog.grupos_canonicos
UNION ALL
SELECT 'core.fornecedores' as tabela, COUNT(*) as total FROM core.fornecedores
UNION ALL
SELECT 'compras.pedidos' as tabela, COUNT(*) as total FROM compras.pedidos
UNION ALL
SELECT 'compras.pedido_itens' as tabela, COUNT(*) as total FROM compras.pedido_itens;


| tabela                        | total |
| ----------------------------- | ----- |
| lens_catalog.lentes           | 1411  |
| lens_catalog.marcas           | 17    |
| lens_catalog.grupos_canonicos | 461   |
| core.fornecedores             | 11    |
| compras.pedidos               | 0     |
| compras.pedido_itens          | 0     |

-- ============================================================================
-- ETAPA 6: VIEWS E FUNCTIONS
-- ============================================================================
-- Views disponíveis
SELECT 
    table_schema as schema,
    table_name as view_nome,
    view_definition
FROM information_schema.views
WHERE table_schema NOT IN ('pg_catalog', 'information_schema')
ORDER BY table_schema, table_name;


| schema       | view_nome                        | view_definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------ | -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| compras      | v_estoque_alertas                |  SELECT id,
    lente_id,
    quantidade_disponivel,
    quantidade_reservada,
    quantidade_minima,
    quantidade_maxima,
    custo_medio,
    valor_total_estoque,
    ultima_entrada,
    ultima_saida,
    updated_at,
        CASE
            WHEN (quantidade_disponivel = 0) THEN 'SEM_ESTOQUE'::text
            WHEN (quantidade_disponivel <= quantidade_minima) THEN 'ESTOQUE_BAIXO'::text
            WHEN (quantidade_disponivel >= quantidade_maxima) THEN 'ESTOQUE_ALTO'::text
            ELSE 'NORMAL'::text
        END AS status_estoque
   FROM compras.estoque_saldo es
  WHERE ((quantidade_disponivel <= quantidade_minima) OR (quantidade_disponivel >= quantidade_maxima));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| compras      | v_itens_pendentes                |  SELECT p.numero_pedido,
    p.fornecedor_id,
    f.nome AS fornecedor_nome,
    p.data_pedido,
    p.data_previsao_entrega,
    pi.lente_id,
    pi.quantidade,
    pi.quantidade_recebida,
    (pi.quantidade - pi.quantidade_recebida) AS quantidade_pendente,
    pi.preco_unitario,
    p.status
   FROM ((compras.pedidos p
     JOIN core.fornecedores f ON ((p.fornecedor_id = f.id)))
     JOIN compras.pedido_itens pi ON ((pi.pedido_id = p.id)))
  WHERE ((p.status <> ALL (ARRAY['recebido'::compras.status_pedido, 'cancelado'::compras.status_pedido])) AND (pi.quantidade > pi.quantidade_recebida));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| compras      | v_pedidos_completos              |  SELECT p.id,
    p.numero_pedido,
    p.fornecedor_id,
    p.status,
    p.data_pedido,
    p.data_confirmacao,
    p.data_previsao_entrega,
    p.data_recebimento,
    p.valor_total,
    p.valor_frete,
    p.valor_desconto,
    p.observacoes,
    p.observacoes_internas,
    p.codigo_rastreio,
    p.created_by,
    p.created_at,
    p.updated_at,
    p.deleted_at,
    f.nome AS fornecedor_nome,
    f.razao_social AS fornecedor_razao_social,
    f.prazo_visao_simples,
    ( SELECT count(*) AS count
           FROM compras.pedido_itens
          WHERE (pedido_itens.pedido_id = p.id)) AS total_itens,
    ( SELECT sum(pedido_itens.quantidade) AS sum
           FROM compras.pedido_itens
          WHERE (pedido_itens.pedido_id = p.id)) AS total_quantidade
   FROM (compras.pedidos p
     JOIN core.fornecedores f ON ((p.fornecedor_id = f.id)));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| extensions   | pg_stat_statements               |  SELECT userid,
    dbid,
    toplevel,
    queryid,
    query,
    plans,
    total_plan_time,
    min_plan_time,
    max_plan_time,
    mean_plan_time,
    stddev_plan_time,
    calls,
    total_exec_time,
    min_exec_time,
    max_exec_time,
    mean_exec_time,
    stddev_exec_time,
    rows,
    shared_blks_hit,
    shared_blks_read,
    shared_blks_dirtied,
    shared_blks_written,
    local_blks_hit,
    local_blks_read,
    local_blks_dirtied,
    local_blks_written,
    temp_blks_read,
    temp_blks_written,
    shared_blk_read_time,
    shared_blk_write_time,
    local_blk_read_time,
    local_blk_write_time,
    temp_blk_read_time,
    temp_blk_write_time,
    wal_records,
    wal_fpi,
    wal_bytes,
    jit_functions,
    jit_generation_time,
    jit_inlining_count,
    jit_inlining_time,
    jit_optimization_count,
    jit_optimization_time,
    jit_emission_count,
    jit_emission_time,
    jit_deform_count,
    jit_deform_time,
    stats_since,
    minmax_stats_since
   FROM pg_stat_statements(true) pg_stat_statements(userid, dbid, toplevel, queryid, query, plans, total_plan_time, min_plan_time, max_plan_time, mean_plan_time, stddev_plan_time, calls, total_exec_time, min_exec_time, max_exec_time, mean_exec_time, stddev_exec_time, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, shared_blk_read_time, shared_blk_write_time, local_blk_read_time, local_blk_write_time, temp_blk_read_time, temp_blk_write_time, wal_records, wal_fpi, wal_bytes, jit_functions, jit_generation_time, jit_inlining_count, jit_inlining_time, jit_optimization_count, jit_optimization_time, jit_emission_count, jit_emission_time, jit_deform_count, jit_deform_time, stats_since, minmax_stats_since);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| extensions   | pg_stat_statements_info          |  SELECT dealloc,
    stats_reset
   FROM pg_stat_statements_info() pg_stat_statements_info(dealloc, stats_reset);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| lens_catalog | v_grupos_canonicos_detalhados    |  SELECT gc.id,
    gc.nome_grupo,
    gc.tipo_lente,
    gc.material,
    gc.indice_refracao,
    gc.grau_esferico_min,
    gc.grau_esferico_max,
    gc.grau_cilindrico_min,
    gc.grau_cilindrico_max,
    gc.adicao_min,
    gc.adicao_max,
    gc.descricao_ranges,
    gc.is_premium,
    gc.total_lentes,
    gc.total_marcas,
    gc.preco_minimo,
    gc.preco_maximo,
    gc.preco_medio,
    (gc.preco_maximo - gc.preco_minimo) AS variacao_preco,
        CASE
            WHEN ((gc.grau_esferico_max - gc.grau_esferico_min) >= (10)::numeric) THEN 'AMPLO'::text
            WHEN ((gc.grau_esferico_max - gc.grau_esferico_min) >= (5)::numeric) THEN 'MÉDIO'::text
            ELSE 'RESTRITO'::text
        END AS amplitude_esferico,
    array_agg(DISTINCT m.nome ORDER BY m.nome) AS marcas_disponiveis,
    ( SELECT l2.nome_lente
           FROM lens_catalog.lentes l2
          WHERE ((l2.grupo_canonico_id = gc.id) AND (l2.ativo = true))
          ORDER BY l2.preco_custo
         LIMIT 1) AS lente_mais_barata,
    ( SELECT l2.nome_lente
           FROM lens_catalog.lentes l2
          WHERE ((l2.grupo_canonico_id = gc.id) AND (l2.ativo = true))
          ORDER BY l2.preco_custo DESC
         LIMIT 1) AS lente_mais_cara
   FROM ((lens_catalog.grupos_canonicos gc
     LEFT JOIN lens_catalog.lentes l ON (((l.grupo_canonico_id = gc.id) AND (l.ativo = true))))
     LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
  GROUP BY gc.id, gc.nome_grupo, gc.tipo_lente, gc.material, gc.indice_refracao, gc.grau_esferico_min, gc.grau_esferico_max, gc.grau_cilindrico_min, gc.grau_cilindrico_max, gc.adicao_min, gc.adicao_max, gc.descricao_ranges, gc.is_premium, gc.total_lentes, gc.total_marcas, gc.preco_minimo, gc.preco_maximo, gc.preco_medio;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| lens_catalog | v_grupos_canonicos_detalhados_v5 |  SELECT gc.id,
    gc.nome_grupo,
    gc.tipo_lente,
    gc.material,
    gc.indice_refracao,
    gc.grau_esferico_min,
    gc.grau_esferico_max,
    gc.grau_cilindrico_min,
    gc.grau_cilindrico_max,
    gc.adicao_min,
    gc.adicao_max,
    gc.descricao_ranges,
    gc.tratamento_antirreflexo,
    gc.tratamento_antirrisco,
    gc.tratamento_uv,
    gc.tratamento_blue_light,
    gc.tratamento_fotossensiveis,
    gc.is_premium,
    gc.total_lentes,
    gc.total_marcas,
    gc.preco_minimo,
    gc.preco_maximo,
    gc.preco_medio,
    (gc.preco_maximo - gc.preco_minimo) AS variacao_preco,
        CASE
            WHEN ((gc.total_lentes >= 5) AND (gc.total_marcas >= 3)) THEN 'EXCELENTE'::text
            WHEN ((gc.total_lentes >= 3) AND (gc.total_marcas >= 2)) THEN 'ÓTIMO'::text
            WHEN (gc.total_lentes >= 2) THEN 'BOM'::text
            ELSE 'LIMITADO'::text
        END AS nivel_comparabilidade,
    array_agg(DISTINCT m.nome ORDER BY m.nome) AS marcas_disponiveis,
    ( SELECT l2.nome_lente
           FROM lens_catalog.lentes l2
          WHERE ((l2.grupo_canonico_id = gc.id) AND (l2.ativo = true))
          ORDER BY l2.preco_custo
         LIMIT 1) AS lente_mais_barata,
    ( SELECT l2.nome_lente
           FROM lens_catalog.lentes l2
          WHERE ((l2.grupo_canonico_id = gc.id) AND (l2.ativo = true))
          ORDER BY l2.preco_custo DESC
         LIMIT 1) AS lente_mais_cara
   FROM ((lens_catalog.grupos_canonicos gc
     LEFT JOIN lens_catalog.lentes l ON (((l.grupo_canonico_id = gc.id) AND (l.ativo = true))))
     LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
  GROUP BY gc.id, gc.nome_grupo, gc.tipo_lente, gc.material, gc.indice_refracao, gc.grau_esferico_min, gc.grau_esferico_max, gc.grau_cilindrico_min, gc.grau_cilindrico_max, gc.adicao_min, gc.adicao_max, gc.descricao_ranges, gc.tratamento_antirreflexo, gc.tratamento_antirrisco, gc.tratamento_uv, gc.tratamento_blue_light, gc.tratamento_fotossensiveis, gc.is_premium, gc.total_lentes, gc.total_marcas, gc.preco_minimo, gc.preco_maximo, gc.preco_medio;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | v_estatisticas_catalogo          |  SELECT ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE (lentes.ativo = true)) AS total_lentes,
    ( SELECT count(*) AS count
           FROM lens_catalog.marcas
          WHERE (marcas.ativo = true)) AS total_marcas,
    ( SELECT count(*) AS count
           FROM core.fornecedores
          WHERE (fornecedores.ativo = true)) AS total_fornecedores,
    ( SELECT count(*) AS count
           FROM lens_catalog.grupos_canonicos) AS total_grupos,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.tipo_lente = 'visao_simples'::lens_catalog.tipo_lente) AND (lentes.ativo = true))) AS lentes_visao_simples,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.tipo_lente = 'multifocal'::lens_catalog.tipo_lente) AND (lentes.ativo = true))) AS lentes_multifocal,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.tipo_lente = 'bifocal'::lens_catalog.tipo_lente) AND (lentes.ativo = true))) AS lentes_bifocal,
    ( SELECT min(lentes.preco_venda_sugerido) AS min
           FROM lens_catalog.lentes
          WHERE (lentes.ativo = true)) AS preco_minimo_geral,
    ( SELECT max(lentes.preco_venda_sugerido) AS max
           FROM lens_catalog.lentes
          WHERE (lentes.ativo = true)) AS preco_maximo_geral,
    ( SELECT avg(lentes.preco_venda_sugerido) AS avg
           FROM lens_catalog.lentes
          WHERE (lentes.ativo = true)) AS preco_medio_geral,
    ( SELECT count(*) AS count
           FROM compras.estoque_saldo
          WHERE (estoque_saldo.quantidade_disponivel > 0)) AS lentes_em_estoque,
    ( SELECT sum(estoque_saldo.quantidade_disponivel) AS sum
           FROM compras.estoque_saldo) AS quantidade_total_estoque,
    ( SELECT sum(estoque_saldo.valor_total_estoque) AS sum
           FROM compras.estoque_saldo) AS valor_total_estoque,
    ( SELECT count(*) AS count
           FROM compras.pedidos
          WHERE (pedidos.status <> ALL (ARRAY['recebido'::compras.status_pedido, 'cancelado'::compras.status_pedido]))) AS pedidos_pendentes,
    ( SELECT count(*) AS count
           FROM compras.pedidos
          WHERE ((pedidos.status = 'recebido'::compras.status_pedido) AND (pedidos.data_recebimento >= (now() - '30 days'::interval)))) AS pedidos_recebidos_mes;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public       | v_estoque_disponivel             |  SELECT l.id AS lente_id,
    l.slug AS lente_slug,
    l.nome_canonizado AS lente_nome,
    f.nome AS fornecedor_nome,
    es.quantidade_disponivel,
    es.quantidade_reservada,
    es.quantidade_minima,
    (es.quantidade_disponivel - es.quantidade_reservada) AS quantidade_livre,
        CASE
            WHEN (es.quantidade_disponivel = 0) THEN 'esgotado'::text
            WHEN (es.quantidade_disponivel <= es.quantidade_minima) THEN 'baixo'::text
            WHEN (es.quantidade_disponivel >= es.quantidade_maxima) THEN 'alto'::text
            ELSE 'normal'::text
        END AS status_estoque,
    es.custo_medio,
    es.valor_total_estoque,
    es.ultima_entrada,
    es.ultima_saida,
    es.updated_at
   FROM ((compras.estoque_saldo es
     JOIN lens_catalog.lentes l ON ((es.lente_id = l.id)))
     JOIN core.fornecedores f ON ((l.fornecedor_id = f.id)))
  WHERE ((es.quantidade_disponivel > 0) AND (l.ativo = true))
  ORDER BY es.quantidade_disponivel;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public       | v_filtros_disponiveis            |  SELECT 'tipo_lente'::text AS filtro_nome,
    (lentes.tipo_lente)::text AS valor,
    count(*) AS total,
    min(lentes.preco_venda_sugerido) AS preco_min,
    max(lentes.preco_venda_sugerido) AS preco_max
   FROM lens_catalog.lentes
  WHERE ((lentes.ativo = true) AND (lentes.status = 'ativo'::lens_catalog.status_lente))
  GROUP BY lentes.tipo_lente
UNION ALL
 SELECT 'material'::text AS filtro_nome,
    (lentes.material)::text AS valor,
    count(*) AS total,
    min(lentes.preco_venda_sugerido) AS preco_min,
    max(lentes.preco_venda_sugerido) AS preco_max
   FROM lens_catalog.lentes
  WHERE ((lentes.ativo = true) AND (lentes.status = 'ativo'::lens_catalog.status_lente))
  GROUP BY lentes.material
UNION ALL
 SELECT 'indice_refracao'::text AS filtro_nome,
    (lentes.indice_refracao)::text AS valor,
    count(*) AS total,
    min(lentes.preco_venda_sugerido) AS preco_min,
    max(lentes.preco_venda_sugerido) AS preco_max
   FROM lens_catalog.lentes
  WHERE ((lentes.ativo = true) AND (lentes.status = 'ativo'::lens_catalog.status_lente))
  GROUP BY lentes.indice_refracao
UNION ALL
 SELECT 'categoria'::text AS filtro_nome,
    (lentes.categoria)::text AS valor,
    count(*) AS total,
    min(lentes.preco_venda_sugerido) AS preco_min,
    max(lentes.preco_venda_sugerido) AS preco_max
   FROM lens_catalog.lentes
  WHERE ((lentes.ativo = true) AND (lentes.status = 'ativo'::lens_catalog.status_lente))
  GROUP BY lentes.categoria
UNION ALL
 SELECT 'marca'::text AS filtro_nome,
    m.nome AS valor,
    count(*) AS total,
    min(l.preco_venda_sugerido) AS preco_min,
    max(l.preco_venda_sugerido) AS preco_max
   FROM (lens_catalog.lentes l
     JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
  WHERE ((l.ativo = true) AND (l.status = 'ativo'::lens_catalog.status_lente))
  GROUP BY m.nome
UNION ALL
 SELECT 'fornecedor'::text AS filtro_nome,
    f.nome AS valor,
    count(*) AS total,
    min(l.preco_venda_sugerido) AS preco_min,
    max(l.preco_venda_sugerido) AS preco_max
   FROM (lens_catalog.lentes l
     JOIN core.fornecedores f ON ((l.fornecedor_id = f.id)))
  WHERE ((l.ativo = true) AND (l.status = 'ativo'::lens_catalog.status_lente))
  GROUP BY f.nome
  ORDER BY 1, 3 DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public       | v_filtros_grupos_canonicos       |  SELECT filtro_categoria,
    filtro_valor,
    count(*) AS total_grupos,
    min(preco_minimo) AS preco_min,
    max(preco_maximo) AS preco_max,
    (avg(preco_medio))::numeric(10,2) AS preco_medio_geral,
    sum(total_lentes) AS total_lentes_agregado
   FROM ( SELECT 'tipo_lente'::text AS filtro_categoria,
            (grupos_canonicos.tipo_lente)::text AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.total_lentes > 0)
        UNION ALL
         SELECT 'material'::text AS filtro_categoria,
            (grupos_canonicos.material)::text AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.total_lentes > 0)
        UNION ALL
         SELECT 'indice_refracao'::text AS filtro_categoria,
            (grupos_canonicos.indice_refracao)::text AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.total_lentes > 0)
        UNION ALL
         SELECT 'categoria'::text AS filtro_categoria,
            (grupos_canonicos.categoria_predominante)::text AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.total_lentes > 0)
        UNION ALL
         SELECT 'is_premium'::text AS filtro_categoria,
                CASE
                    WHEN grupos_canonicos.is_premium THEN 'premium'::text
                    ELSE 'generico'::text
                END AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.total_lentes > 0)
        UNION ALL
         SELECT 'antirreflexo'::text AS filtro_categoria,
                CASE
                    WHEN grupos_canonicos.tem_antirreflexo THEN 'sim'::text
                    ELSE 'nao'::text
                END AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.total_lentes > 0)
        UNION ALL
         SELECT 'blue_light'::text AS filtro_categoria,
                CASE
                    WHEN grupos_canonicos.tem_blue_light THEN 'sim'::text
                    ELSE 'nao'::text
                END AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.total_lentes > 0)
        UNION ALL
         SELECT 'fotossensiveis'::text AS filtro_categoria,
            (grupos_canonicos.tratamento_foto)::text AS filtro_valor,
            grupos_canonicos.preco_minimo,
            grupos_canonicos.preco_maximo,
            grupos_canonicos.preco_medio,
            grupos_canonicos.total_lentes
           FROM lens_catalog.grupos_canonicos
          WHERE ((grupos_canonicos.total_lentes > 0) AND (grupos_canonicos.tratamento_foto IS NOT NULL) AND ((grupos_canonicos.tratamento_foto)::text <> 'nenhum'::text))) filtros_agregados
  GROUP BY filtro_categoria, filtro_valor
  ORDER BY filtro_categoria, (count(*)) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | v_fornecedores_catalogo          |  SELECT id,
    nome,
    razao_social,
    prazo_visao_simples,
    prazo_multifocal,
    prazo_surfacada,
    prazo_free_form,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.fornecedor_id = f.id) AND (lentes.ativo = true))) AS total_lentes,
    ( SELECT count(DISTINCT lentes.marca_id) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.fornecedor_id = f.id) AND (lentes.ativo = true))) AS total_marcas,
    ( SELECT min(lentes.preco_venda_sugerido) AS min
           FROM lens_catalog.lentes
          WHERE ((lentes.fornecedor_id = f.id) AND (lentes.ativo = true))) AS preco_minimo,
    ( SELECT max(lentes.preco_venda_sugerido) AS max
           FROM lens_catalog.lentes
          WHERE ((lentes.fornecedor_id = f.id) AND (lentes.ativo = true))) AS preco_maximo,
    ( SELECT avg(lentes.preco_venda_sugerido) AS avg
           FROM lens_catalog.lentes
          WHERE ((lentes.fornecedor_id = f.id) AND (lentes.ativo = true))) AS preco_medio,
    ((frete_config -> 'contato'::text) ->> 'email'::text) AS email_contato,
    ((frete_config -> 'contato'::text) ->> 'telefone'::text) AS telefone_contato,
    jsonb_build_object('tipo', (frete_config ->> 'tipo'::text), 'frete_gratis_acima', (frete_config ->> 'frete_gratis_acima'::text), 'taxa_fixa', (frete_config ->> 'taxa_fixa'::text)) AS config_frete,
        CASE
            WHEN (prazo_visao_simples <= 3) THEN 'express'::text
            WHEN (prazo_visao_simples <= 7) THEN 'normal'::text
            ELSE 'economico'::text
        END AS badge_prazo,
    ativo,
    created_at
   FROM core.fornecedores f
  WHERE ((ativo = true) AND (deleted_at IS NULL))
  ORDER BY prazo_visao_simples, nome;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public       | v_fornecedores_por_lente         |  SELECT l.id AS lente_id,
    l.nome_lente AS lente_nome,
    l.slug AS lente_slug,
    l.tipo_lente,
    l.material,
    l.indice_refracao,
    f.id AS fornecedor_id,
    f.nome AS fornecedor_nome,
    f.razao_social AS fornecedor_razao_social,
    f.cnpj,
    l.preco_custo,
    COALESCE(l.lead_time_dias,
        CASE l.tipo_lente
            WHEN 'visao_simples'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'multifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'bifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'leitura'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'ocupacional'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            ELSE 10
        END) AS prazo_entrega_dias,
    m.nome AS marca_nome,
    m.is_premium AS marca_premium,
    l.ativo AS lente_ativa,
    f.ativo AS fornecedor_ativo,
    row_number() OVER (PARTITION BY l.id ORDER BY COALESCE(l.lead_time_dias,
        CASE l.tipo_lente
            WHEN 'visao_simples'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'multifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'bifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'leitura'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'ocupacional'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            ELSE 10
        END), l.preco_custo) AS ranking_fornecedor
   FROM ((lens_catalog.lentes l
     JOIN core.fornecedores f ON ((f.id = l.fornecedor_id)))
     LEFT JOIN lens_catalog.marcas m ON ((m.id = l.marca_id)))
  WHERE ((l.ativo = true) AND (f.ativo = true))
  ORDER BY l.nome_lente, COALESCE(l.lead_time_dias,
        CASE l.tipo_lente
            WHEN 'visao_simples'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'multifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'bifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'leitura'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'ocupacional'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            ELSE 10
        END);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public       | v_grupos_canonicos               |  SELECT id,
    slug,
    nome_grupo,
    tipo_lente,
    material,
    indice_refracao,
    categoria_predominante,
    grau_esferico_min,
    grau_esferico_max,
    grau_cilindrico_min,
    grau_cilindrico_max,
    adicao_min,
    adicao_max,
    descricao_ranges,
    tratamento_antirreflexo,
    tratamento_antirrisco,
    tratamento_uv,
    tratamento_blue_light,
    tratamento_fotossensiveis,
    preco_minimo,
    preco_maximo,
    preco_medio,
    total_lentes,
    total_marcas,
    peso,
    is_premium
   FROM lens_catalog.grupos_canonicos gc
  WHERE ((ativo = true) AND (is_premium = false))
  ORDER BY preco_medio;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public       | v_grupos_canonicos_completos     |  SELECT id,
    nome_grupo,
    tipo_lente,
    material,
    indice_refracao,
    preco_medio,
    ( SELECT jsonb_agg(jsonb_build_object('id', l.id, 'nome', f.nome, 'prazo_visao_simples', COALESCE(f.prazo_visao_simples, 0), 'prazo_multifocal', COALESCE(f.prazo_multifocal, 2))) AS jsonb_agg
           FROM (lens_catalog.lentes l
             JOIN core.fornecedores f ON ((l.fornecedor_id = f.id)))
          WHERE (l.grupo_canonico_id = gc.id)) AS fornecedores_disponiveis,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes l
          WHERE (l.grupo_canonico_id = gc.id)) AS total_lentes,
    false AS is_premium
   FROM lens_catalog.grupos_canonicos gc;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public       | v_grupos_com_lentes              |  SELECT id AS grupo_id,
    slug AS grupo_slug,
    nome_grupo,
    tipo_lente,
    material,
    indice_refracao,
    preco_medio,
    preco_minimo,
    preco_maximo,
    ( SELECT jsonb_agg(jsonb_build_object('id', l.id, 'slug', l.slug, 'nome', l.nome_canonizado, 'fornecedor_id', f.id, 'fornecedor_nome', f.nome, 'marca', m.nome, 'preco', l.preco_venda_sugerido, 'prazo_dias', f.prazo_visao_simples, 'estoque', COALESCE(es.quantidade_disponivel, 0), 'tratamentos', jsonb_build_object('ar', l.tratamento_antirreflexo, 'antirrisco', l.tratamento_antirrisco, 'uv', l.tratamento_uv, 'blue_light', l.tratamento_blue_light, 'foto', l.tratamento_fotossensiveis)) ORDER BY l.preco_venda_sugerido) AS jsonb_agg
           FROM (((lens_catalog.lentes l
             JOIN core.fornecedores f ON ((l.fornecedor_id = f.id)))
             LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
             LEFT JOIN compras.estoque_saldo es ON ((l.id = es.lente_id)))
          WHERE ((l.grupo_canonico_id = gc.id) AND (l.ativo = true) AND (l.status = 'ativo'::lens_catalog.status_lente))) AS lentes
   FROM lens_catalog.grupos_canonicos gc
  WHERE (EXISTS ( SELECT 1
           FROM lens_catalog.lentes l
          WHERE ((l.grupo_canonico_id = gc.id) AND (l.ativo = true))))
  ORDER BY is_premium DESC, preco_medio;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| public       | v_grupos_melhor_margem           |  WITH margem_calculada AS (
         SELECT gc.id AS grupo_id,
            gc.slug AS grupo_slug,
            gc.nome_grupo,
            gc.tipo_lente,
            gc.material,
            gc.indice_refracao,
            gc.tratamento_antirreflexo,
            gc.tratamento_antirrisco,
            gc.tratamento_uv,
            gc.tratamento_blue_light,
            gc.tratamento_fotossensiveis,
            gc.preco_minimo,
            gc.preco_medio,
            gc.preco_maximo,
            avg(l.preco_custo) AS custo_medio,
            min(l.preco_custo) AS custo_minimo,
            max(l.preco_custo) AS custo_maximo,
                CASE
                    WHEN (avg(l.preco_custo) > (0)::numeric) THEN ((((gc.preco_medio - avg(l.preco_custo)) / avg(l.preco_custo)) * (100)::numeric))::numeric(8,2)
                    ELSE (0)::numeric
                END AS margem_percentual,
            ((gc.preco_medio - avg(l.preco_custo)))::numeric(10,2) AS lucro_unitario,
                CASE
                    WHEN (avg(l.preco_custo) > (0)::numeric) THEN ((gc.preco_medio / avg(l.preco_custo)))::numeric(6,2)
                    ELSE NULL::numeric
                END AS markup,
            gc.total_lentes,
            gc.is_premium,
            count(DISTINCT l.marca_id) AS total_marcas,
            count(DISTINCT l.fornecedor_id) AS total_fornecedores
           FROM (lens_catalog.grupos_canonicos gc
             JOIN lens_catalog.lentes l ON (((l.grupo_canonico_id = gc.id) AND (l.ativo = true))))
          GROUP BY gc.id, gc.slug, gc.nome_grupo, gc.tipo_lente, gc.material, gc.indice_refracao, gc.tratamento_antirreflexo, gc.tratamento_antirrisco, gc.tratamento_uv, gc.tratamento_blue_light, gc.tratamento_fotossensiveis, gc.preco_minimo, gc.preco_medio, gc.preco_maximo, gc.total_lentes, gc.is_premium
        )
 SELECT grupo_id,
    grupo_slug,
    nome_grupo,
    tipo_lente,
    material,
    indice_refracao,
    tratamento_antirreflexo,
    tratamento_antirrisco,
    tratamento_uv,
    tratamento_blue_light,
    tratamento_fotossensiveis,
    preco_minimo,
    preco_medio,
    preco_maximo,
    custo_medio,
    custo_minimo,
    custo_maximo,
    margem_percentual,
    lucro_unitario,
    markup,
    total_lentes,
    is_premium,
    total_marcas,
    total_fornecedores,
    row_number() OVER (ORDER BY margem_percentual DESC) AS ranking_margem,
    row_number() OVER (PARTITION BY tipo_lente ORDER BY margem_percentual DESC) AS ranking_por_tipo,
        CASE
            WHEN (margem_percentual >= (400)::numeric) THEN 'Excelente'::text
            WHEN (margem_percentual >= (350)::numeric) THEN 'Ótima'::text
            WHEN (margem_percentual >= (300)::numeric) THEN 'Boa'::text
            ELSE 'Regular'::text
        END AS classificacao_margem,
        CASE
            WHEN (markup >= 4.0) THEN true
            ELSE false
        END AS acima_markup_padrao
   FROM margem_calculada
  ORDER BY margem_percentual DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| public       | v_grupos_por_faixa_preco         |  SELECT id AS grupo_id,
    slug AS grupo_slug,
    nome_grupo,
    tipo_lente,
    material,
    indice_refracao,
    tratamento_antirreflexo,
    tratamento_antirrisco,
    tratamento_uv,
    tratamento_blue_light,
    tratamento_fotossensiveis,
    preco_minimo,
    preco_medio,
    preco_maximo,
        CASE
            WHEN (preco_medio < (150)::numeric) THEN '< R$150'::text
            WHEN ((preco_medio >= (150)::numeric) AND (preco_medio < (300)::numeric)) THEN 'R$150-300'::text
            WHEN ((preco_medio >= (300)::numeric) AND (preco_medio < (500)::numeric)) THEN 'R$300-500'::text
            WHEN ((preco_medio >= (500)::numeric) AND (preco_medio < (800)::numeric)) THEN 'R$500-800'::text
            ELSE 'R$800+'::text
        END AS faixa_preco,
        CASE
            WHEN (preco_medio < (150)::numeric) THEN 1
            WHEN ((preco_medio >= (150)::numeric) AND (preco_medio < (300)::numeric)) THEN 2
            WHEN ((preco_medio >= (300)::numeric) AND (preco_medio < (500)::numeric)) THEN 3
            WHEN ((preco_medio >= (500)::numeric) AND (preco_medio < (800)::numeric)) THEN 4
            ELSE 5
        END AS faixa_ordem,
        CASE
            WHEN (preco_medio < (150)::numeric) THEN 'R$150-300'::text
            WHEN ((preco_medio >= (150)::numeric) AND (preco_medio < (300)::numeric)) THEN 'R$300-500'::text
            WHEN ((preco_medio >= (300)::numeric) AND (preco_medio < (500)::numeric)) THEN 'R$500-800'::text
            WHEN ((preco_medio >= (500)::numeric) AND (preco_medio < (800)::numeric)) THEN 'R$800+'::text
            ELSE NULL::text
        END AS proxima_faixa,
        CASE
            WHEN (preco_medio < (150)::numeric) THEN 'Entrada'::text
            WHEN ((preco_medio >= (150)::numeric) AND (preco_medio < (300)::numeric)) THEN 'Básico'::text
            WHEN ((preco_medio >= (300)::numeric) AND (preco_medio < (500)::numeric)) THEN 'Intermediário'::text
            WHEN ((preco_medio >= (500)::numeric) AND (preco_medio < (800)::numeric)) THEN 'Premium'::text
            ELSE 'Super Premium'::text
        END AS descricao_faixa,
    total_lentes,
    is_premium,
    ( SELECT count(DISTINCT lentes.marca_id) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.grupo_canonico_id = gc.id) AND (lentes.ativo = true))) AS total_marcas,
    ( SELECT count(DISTINCT lentes.fornecedor_id) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.grupo_canonico_id = gc.id) AND (lentes.ativo = true))) AS total_fornecedores
   FROM lens_catalog.grupos_canonicos gc
  ORDER BY preco_medio;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | v_grupos_por_receita_cliente     |  SELECT gc.id AS grupo_id,
    gc.slug AS grupo_slug,
    gc.nome_grupo,
    gc.tipo_lente,
    gc.material,
    gc.indice_refracao,
    min(l.grau_esferico_min) AS grau_esferico_min,
    max(l.grau_esferico_max) AS grau_esferico_max,
    min(l.grau_cilindrico_min) AS grau_cilindrico_min,
    max(l.grau_cilindrico_max) AS grau_cilindrico_max,
    min(l.adicao_min) AS adicao_min,
    max(l.adicao_max) AS adicao_max,
    gc.tratamento_antirreflexo,
    gc.tratamento_antirrisco,
    gc.tratamento_uv,
    gc.tratamento_blue_light,
    gc.tratamento_fotossensiveis,
    gc.preco_minimo,
    gc.preco_medio,
    gc.preco_maximo,
    avg(l.preco_custo) AS custo_medio,
        CASE
            WHEN (avg(l.preco_custo) > (0)::numeric) THEN ((gc.preco_medio / avg(l.preco_custo)))::numeric(5,2)
            ELSE NULL::numeric
        END AS margem_media,
        CASE
            WHEN (gc.preco_medio < (150)::numeric) THEN 'economica'::text
            WHEN ((gc.preco_medio >= (150)::numeric) AND (gc.preco_medio <= (400)::numeric)) THEN 'intermediaria'::text
            ELSE 'premium'::text
        END AS categoria_sugerida,
    gc.total_lentes,
    count(DISTINCT l.fornecedor_id) AS total_fornecedores,
    count(DISTINCT l.marca_id) AS total_marcas,
    gc.is_premium,
    (avg(
        CASE gc.tipo_lente
            WHEN 'visao_simples'::lens_catalog.tipo_lente THEN COALESCE(f.prazo_visao_simples, 7)
            WHEN 'multifocal'::lens_catalog.tipo_lente THEN COALESCE(f.prazo_multifocal, 10)
            WHEN 'bifocal'::lens_catalog.tipo_lente THEN COALESCE(f.prazo_multifocal, 10)
            WHEN 'leitura'::lens_catalog.tipo_lente THEN COALESCE(f.prazo_visao_simples, 7)
            WHEN 'ocupacional'::lens_catalog.tipo_lente THEN COALESCE(f.prazo_multifocal, 10)
            ELSE 10
        END))::integer AS prazo_medio_dias
   FROM ((lens_catalog.grupos_canonicos gc
     JOIN lens_catalog.lentes l ON (((l.grupo_canonico_id = gc.id) AND (l.ativo = true))))
     LEFT JOIN core.fornecedores f ON ((f.id = l.fornecedor_id)))
  GROUP BY gc.id, gc.slug, gc.nome_grupo, gc.tipo_lente, gc.material, gc.indice_refracao, gc.tratamento_antirreflexo, gc.tratamento_antirrisco, gc.tratamento_uv, gc.tratamento_blue_light, gc.tratamento_fotossensiveis, gc.preco_minimo, gc.preco_medio, gc.preco_maximo, gc.total_lentes, gc.is_premium
  ORDER BY gc.preco_medio;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | v_grupos_premium                 |  SELECT id,
    slug,
    nome_grupo,
    tipo_lente,
    material,
    indice_refracao,
    categoria_predominante,
    grau_esferico_min,
    grau_esferico_max,
    grau_cilindrico_min,
    grau_cilindrico_max,
    adicao_min,
    adicao_max,
    descricao_ranges,
    tratamento_antirreflexo,
    tratamento_antirrisco,
    tratamento_uv,
    tratamento_blue_light,
    tratamento_fotossensiveis,
    preco_minimo,
    preco_maximo,
    preco_medio,
    total_lentes,
    total_marcas,
    peso,
    is_premium,
    COALESCE(( SELECT jsonb_agg(DISTINCT jsonb_build_object('marca_id', m.id, 'marca_nome', m.nome, 'marca_slug', m.slug, 'is_premium', m.is_premium)) AS jsonb_agg
           FROM (lens_catalog.lentes l
             JOIN lens_catalog.marcas m ON ((m.id = l.marca_id)))
          WHERE ((l.grupo_canonico_id = gc.id) AND (l.ativo = true) AND (m.ativo = true))), '[]'::jsonb) AS marcas_disponiveis,
    COALESCE(( SELECT string_agg(DISTINCT (m.nome)::text, ', '::text ORDER BY (m.nome)::text) AS string_agg
           FROM (lens_catalog.lentes l
             JOIN lens_catalog.marcas m ON ((m.id = l.marca_id)))
          WHERE ((l.grupo_canonico_id = gc.id) AND (l.ativo = true) AND (m.ativo = true))), ''::text) AS marcas_nomes
   FROM lens_catalog.grupos_canonicos gc
  WHERE ((ativo = true) AND (is_premium = true))
  ORDER BY preco_medio;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public       | v_lentes_busca                   |  SELECT l.id,
    l.slug,
    l.nome_canonizado AS nome,
    f.nome AS fornecedor,
    m.nome AS marca,
    l.tipo_lente,
    l.material,
    l.indice_refracao,
    l.categoria,
    l.preco_venda_sugerido AS preco,
    l.tratamento_antirreflexo AS tem_ar,
    l.tratamento_blue_light AS tem_blue,
    l.tratamento_fotossensiveis AS tratamento_foto,
    gc.nome_grupo,
    l.peso,
    ((((((((((l.nome_canonizado || ' '::text) || f.nome) || ' '::text) || (COALESCE(m.nome, ''::character varying))::text) || ' '::text) || (l.tipo_lente)::text) || ' '::text) || (l.material)::text) || ' '::text) || (l.indice_refracao)::text) AS search_text
   FROM (((lens_catalog.lentes l
     JOIN core.fornecedores f ON ((l.fornecedor_id = f.id)))
     LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
     LEFT JOIN lens_catalog.grupos_canonicos gc ON ((l.grupo_canonico_id = gc.id)))
  WHERE ((l.ativo = true) AND (l.status = 'ativo'::lens_catalog.status_lente) AND (l.deleted_at IS NULL));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public       | v_lentes_catalogo                |  SELECT l.id,
    l.slug,
    l.nome_lente,
    l.nome_canonizado,
    f.id AS fornecedor_id,
    f.nome AS fornecedor_nome,
    f.prazo_visao_simples,
    f.prazo_multifocal,
    f.prazo_surfacada,
    f.prazo_free_form,
    m.id AS marca_id,
    m.nome AS marca_nome,
    m.slug AS marca_slug,
    m.is_premium AS marca_premium,
    gc.id AS grupo_id,
    gc.nome_grupo,
    gc.slug AS grupo_slug,
    l.tipo_lente,
    l.material,
    l.indice_refracao,
    l.categoria,
    l.tratamento_antirreflexo,
    l.tratamento_antirrisco,
    l.tratamento_uv,
    l.tratamento_blue_light,
    l.tratamento_fotossensiveis,
    l.diametro_mm,
    l.curva_base,
    l.espessura_centro_mm,
    l.grau_esferico_min,
    l.grau_esferico_max,
    l.grau_cilindrico_min,
    l.grau_cilindrico_max,
    l.adicao_min,
    l.adicao_max,
    l.preco_custo,
    l.preco_venda_sugerido,
    l.margem_lucro,
    COALESCE(es.quantidade_disponivel, 0) AS estoque_disponivel,
    COALESCE(es.quantidade_reservada, 0) AS estoque_reservado,
    l.status,
    l.ativo,
    l.peso,
    l.metadata,
    l.created_at,
    l.updated_at
   FROM ((((lens_catalog.lentes l
     JOIN core.fornecedores f ON ((l.fornecedor_id = f.id)))
     LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
     LEFT JOIN lens_catalog.grupos_canonicos gc ON ((l.grupo_canonico_id = gc.id)))
     LEFT JOIN compras.estoque_saldo es ON ((l.id = es.lente_id)))
  WHERE ((l.ativo = true) AND (l.deleted_at IS NULL))
  ORDER BY l.peso DESC, l.preco_venda_sugerido;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public       | v_lentes_cotacao_compra          |  SELECT l.id AS lente_id,
    l.slug AS lente_slug,
    l.nome_lente AS lente_nome,
    l.nome_canonizado,
    l.tipo_lente,
    l.material,
    l.indice_refracao,
    l.fornecedor_id,
    f.nome AS fornecedor_nome,
    l.marca_id,
    m.nome AS marca_nome,
    l.preco_custo,
    COALESCE(l.lead_time_dias,
        CASE l.tipo_lente
            WHEN 'visao_simples'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'multifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'bifocal'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            WHEN 'leitura'::lens_catalog.tipo_lente THEN f.prazo_visao_simples
            WHEN 'ocupacional'::lens_catalog.tipo_lente THEN f.prazo_multifocal
            ELSE 10
        END) AS prazo_dias,
    l.ativo,
    l.categoria,
    l.grupo_canonico_id
   FROM ((lens_catalog.lentes l
     JOIN core.fornecedores f ON ((f.id = l.fornecedor_id)))
     LEFT JOIN lens_catalog.marcas m ON ((m.id = l.marca_id)))
  WHERE ((l.ativo = true) AND (f.ativo = true))
  ORDER BY l.nome_lente;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public       | v_pedidos_pendentes              |  SELECT p.id,
    p.numero_pedido,
    f.nome AS fornecedor_nome,
    p.status,
    p.data_pedido,
    p.data_previsao_entrega,
    p.valor_total,
        CASE
            WHEN (p.data_previsao_entrega IS NOT NULL) THEN (EXTRACT(day FROM (p.data_previsao_entrega - now())))::integer
            ELSE NULL::integer
        END AS dias_ate_entrega,
        CASE
            WHEN ((p.status = 'enviado_fornecedor'::compras.status_pedido) AND (p.data_previsao_entrega < now())) THEN 'atrasado'::text
            WHEN (p.status = 'enviado_fornecedor'::compras.status_pedido) THEN 'em_transito'::text
            WHEN (p.status = ANY (ARRAY['confirmado'::compras.status_pedido, 'em_producao'::compras.status_pedido])) THEN 'processando'::text
            ELSE 'pendente'::text
        END AS status_visual,
    ( SELECT count(*) AS count
           FROM compras.pedido_itens
          WHERE (pedido_itens.pedido_id = p.id)) AS total_itens,
    ( SELECT sum(pedido_itens.quantidade) AS sum
           FROM compras.pedido_itens
          WHERE (pedido_itens.pedido_id = p.id)) AS total_quantidade,
    p.codigo_rastreio,
    p.created_at
   FROM (compras.pedidos p
     JOIN core.fornecedores f ON ((p.fornecedor_id = f.id)))
  WHERE ((p.status <> ALL (ARRAY['recebido'::compras.status_pedido, 'cancelado'::compras.status_pedido])) AND (p.deleted_at IS NULL))
  ORDER BY p.data_previsao_entrega, p.created_at DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| public       | v_sugestoes_upgrade              |  WITH grupos_base AS (
         SELECT gc.id,
            gc.nome_grupo,
            gc.tipo_lente,
            gc.material,
            gc.indice_refracao,
            gc.preco_medio,
            gc.tratamento_antirreflexo,
            gc.tratamento_antirrisco,
            gc.tratamento_uv,
            gc.tratamento_blue_light,
            gc.tratamento_fotossensiveis,
            ((((
                CASE
                    WHEN gc.tratamento_antirreflexo THEN 1
                    ELSE 0
                END +
                CASE
                    WHEN gc.tratamento_antirrisco THEN 1
                    ELSE 0
                END) +
                CASE
                    WHEN gc.tratamento_uv THEN 1
                    ELSE 0
                END) +
                CASE
                    WHEN gc.tratamento_blue_light THEN 1
                    ELSE 0
                END) +
                CASE
                    WHEN (gc.tratamento_fotossensiveis <> 'nenhum'::text) THEN 1
                    ELSE 0
                END) AS total_tratamentos
           FROM lens_catalog.grupos_canonicos gc
        )
 SELECT gb.id AS grupo_base_id,
    gb.nome_grupo AS grupo_base_nome,
    gb.preco_medio AS preco_base,
    gb.total_tratamentos AS tratamentos_base,
    gu.id AS grupo_upgrade_id,
    gu.nome_grupo AS grupo_upgrade_nome,
    gu.preco_medio AS preco_upgrade,
    gu.total_tratamentos AS tratamentos_upgrade,
    ((gu.preco_medio - gb.preco_medio))::numeric(10,2) AS diferenca_preco,
    ((((gu.preco_medio - gb.preco_medio) / gb.preco_medio) * (100)::numeric))::numeric(5,2) AS diferenca_percentual,
    array_remove(ARRAY[
        CASE
            WHEN (gu.tratamento_antirreflexo AND (NOT gb.tratamento_antirreflexo)) THEN 'Antirreflexo'::text
            ELSE NULL::text
        END,
        CASE
            WHEN (gu.tratamento_antirrisco AND (NOT gb.tratamento_antirrisco)) THEN 'Antirrisco'::text
            ELSE NULL::text
        END,
        CASE
            WHEN (gu.tratamento_uv AND (NOT gb.tratamento_uv)) THEN 'Proteção UV'::text
            ELSE NULL::text
        END,
        CASE
            WHEN (gu.tratamento_blue_light AND (NOT gb.tratamento_blue_light)) THEN 'Filtro Luz Azul'::text
            ELSE NULL::text
        END,
        CASE
            WHEN ((gu.tratamento_fotossensiveis <> 'nenhum'::text) AND (gb.tratamento_fotossensiveis = 'nenhum'::text)) THEN (('Fotossensível ('::text || gu.tratamento_fotossensiveis) || ')'::text)
            ELSE NULL::text
        END], NULL::text) AS tratamentos_adicionais,
        CASE
            WHEN (gu.tratamento_blue_light AND (NOT gb.tratamento_blue_light)) THEN 'Proteção contra luz azul de telas + maior conforto visual'::text
            WHEN (gu.tratamento_antirreflexo AND (NOT gb.tratamento_antirreflexo)) THEN 'Visão mais nítida e sem reflexos + estética melhor'::text
            WHEN ((gu.tratamento_fotossensiveis <> 'nenhum'::text) AND (gb.tratamento_fotossensiveis = 'nenhum'::text)) THEN 'Adaptação automática à luminosidade + proteção solar'::text
            ELSE 'Proteção e durabilidade superiores'::text
        END AS beneficios,
    gb.tipo_lente,
    gb.material,
    gb.indice_refracao,
    (gu.total_tratamentos - gb.total_tratamentos) AS tratamentos_extras_count
   FROM (grupos_base gb
     JOIN grupos_base gu ON (((gu.tipo_lente = gb.tipo_lente) AND (gu.material = gb.material) AND (gu.indice_refracao = gb.indice_refracao) AND (gu.total_tratamentos > gb.total_tratamentos) AND (gu.preco_medio > gb.preco_medio) AND (gu.preco_medio <= (gb.preco_medio * (2)::numeric)) AND (gu.id <> gb.id))))
  ORDER BY gb.preco_medio, (((gu.preco_medio - gb.preco_medio))::numeric(10,2));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public       | vw_bi_lentes_lucratividade       |  SELECT COALESCE(m.nome, 'Indefinido'::character varying) AS marca,
    COALESCE((l.categoria)::text, 'Geral'::text) AS categoria,
    count(*) AS qtd_produtos,
    (avg(l.custo_base))::numeric(10,2) AS custo_medio,
    (avg(l.preco_tabela))::numeric(10,2) AS preco_medio
   FROM (lens_catalog.lentes l
     LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
  WHERE (l.custo_base > (0)::numeric)
  GROUP BY m.nome, l.categoria;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| public       | vw_canonicas_genericas           |  SELECT lc.id,
    lc.nome_canonico,
    lc.descricao,
    lc.tipo_lente,
    lc.material,
    lc.indice_refracao,
    lc.categoria,
    lc.ar,
    lc.blue,
    lc.fotossensivel,
    lc.polarizado,
    lc.esferico_min,
    lc.esferico_max,
    lc.cilindrico_min,
    lc.cilindrico_max,
    lc.adicao_min,
    lc.adicao_max,
    lc.total_lentes,
    lc.preco_minimo,
    lc.preco_maximo,
    lc.preco_medio,
    count(l.id) AS lentes_ativas,
    count(DISTINCT l.marca_id) AS total_marcas,
    array_agg(DISTINCT m.nome ORDER BY m.nome) FILTER (WHERE (m.nome IS NOT NULL)) AS marcas_disponiveis,
    lc.ativo,
    lc.created_at,
    lc.updated_at
   FROM ((lens_catalog.lentes_canonicas lc
     LEFT JOIN lens_catalog.lentes l ON (((l.lente_canonica_id = lc.id) AND (l.status = 'ativo'::lens_catalog.status_lente))))
     LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
  WHERE (lc.ativo = true)
  GROUP BY lc.id, lc.nome_canonico, lc.descricao, lc.tipo_lente, lc.material, lc.indice_refracao, lc.categoria, lc.ar, lc.blue, lc.fotossensivel, lc.polarizado, lc.esferico_min, lc.esferico_max, lc.cilindrico_min, lc.cilindrico_max, lc.adicao_min, lc.adicao_max, lc.total_lentes, lc.preco_minimo, lc.preco_maximo, lc.preco_medio, lc.ativo, lc.created_at, lc.updated_at
  ORDER BY lc.nome_canonico;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public       | vw_canonicas_premium             |  SELECT pc.id,
    pc.marca_id,
    pc.linha_produto,
    pc.nome_canonico,
    pc.descricao,
    pc.tipo_lente,
    pc.material,
    pc.indice_refracao,
    pc.categoria,
    m.nome AS marca_nome,
    m.slug AS marca_slug,
    m.is_premium AS marca_premium,
    pc.ar,
    pc.blue,
    pc.fotossensivel,
    pc.polarizado,
    pc.esferico_min,
    pc.esferico_max,
    pc.cilindrico_min,
    pc.cilindrico_max,
    pc.adicao_min,
    pc.adicao_max,
    pc.total_lentes,
    pc.preco_minimo,
    pc.preco_maximo,
    pc.preco_medio,
    count(l.id) AS lentes_ativas,
    pc.ativo,
    pc.created_at,
    pc.updated_at
   FROM ((lens_catalog.premium_canonicas pc
     LEFT JOIN lens_catalog.marcas m ON ((pc.marca_id = m.id)))
     LEFT JOIN lens_catalog.lentes l ON (((l.premium_canonica_id = pc.id) AND (l.status = 'ativo'::lens_catalog.status_lente))))
  WHERE (pc.ativo = true)
  GROUP BY pc.id, pc.marca_id, pc.linha_produto, pc.nome_canonico, pc.descricao, pc.tipo_lente, pc.material, pc.indice_refracao, pc.categoria, m.nome, m.slug, m.is_premium, pc.ar, pc.blue, pc.fotossensivel, pc.polarizado, pc.esferico_min, pc.esferico_max, pc.cilindrico_min, pc.cilindrico_max, pc.adicao_min, pc.adicao_max, pc.total_lentes, pc.preco_minimo, pc.preco_maximo, pc.preco_medio, pc.ativo, pc.created_at, pc.updated_at
  ORDER BY m.nome, pc.nome_canonico;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| public       | vw_detalhes_premium              |  SELECT pc.id AS canonica_id,
    pc.nome_canonico,
    pc.linha_produto AS canonica_linha,
    pc.tipo_lente AS canonica_tipo_lente,
    pc.material AS canonica_material,
    pc.indice_refracao AS canonica_indice,
    l.id AS lente_id,
    l.sku_fornecedor,
    l.codigo_original,
    l.nome_comercial,
    l.linha_produto,
    l.categoria,
    l.material,
    l.indice_refracao,
    m.id AS marca_id,
    m.nome AS marca_nome,
    m.slug AS marca_slug,
    m.is_premium AS marca_premium,
    l.ar,
    l.antirrisco,
    l.hidrofobico,
    l."antiembaçante",
    l.blue,
    l.uv400,
    l.fotossensivel,
    l.polarizado,
    l.digital,
    l.free_form,
    l.indoor,
    l.drive,
    l.esferico_min,
    l.esferico_max,
    l.cilindrico_min,
    l.cilindrico_max,
    l.adicao_min,
    l.adicao_max,
    l.diametro,
    l.espessura_central,
    l.custo_base,
    l.preco_tabela,
    l.preco_fabricante,
    l.disponivel,
    l.prazo_entrega,
    l.obs_prazo,
    l.destaque,
    l.novidade,
    l.descricao_curta,
    l.beneficios
   FROM ((lens_catalog.premium_canonicas pc
     JOIN lens_catalog.lentes l ON ((l.premium_canonica_id = pc.id)))
     JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
  WHERE ((pc.ativo = true) AND (l.status = 'ativo'::lens_catalog.status_lente) AND (l.disponivel = true))
  ORDER BY pc.nome_canonico, m.nome, l.preco_tabela;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public       | vw_lentes_catalogo               |  SELECT l.id,
    l.marca_id,
    l.fornecedor_id,
    l.lente_canonica_id,
    l.premium_canonica_id,
    l.sku_fornecedor,
    l.codigo_original,
    l.nome_comercial,
    m.nome AS marca_nome,
    m.slug AS marca_slug,
    m.is_premium AS marca_premium,
    l.tipo_lente,
    l.categoria,
    l.material,
    l.indice_refracao,
    l.linha_produto,
    l.diametro,
    l.espessura_central,
    l.peso_aproximado,
    l.esferico_min,
    l.esferico_max,
    l.cilindrico_min,
    l.cilindrico_max,
    l.adicao_min,
    l.adicao_max,
    l.dnp_min,
    l.dnp_max,
    l.ar,
    l.antirrisco,
    l.hidrofobico,
    l."antiembaçante",
    l.blue,
    l.uv400,
    l.fotossensivel,
    l.polarizado,
    l.digital,
    l.free_form,
    l.indoor,
    l.drive,
    l.custo_base,
    l.preco_fabricante,
    l.preco_tabela,
    l.prazo_entrega,
    l.obs_prazo,
    l.peso_frete,
    l.exige_receita_especial,
    l.descricao_curta,
    l.descricao_completa,
    l.beneficios,
    l.indicacoes,
    l.contraindicacoes,
    l.observacoes,
    l.status,
    l.disponivel,
    l.destaque,
    l.novidade,
    l.data_lancamento,
    l.data_descontinuacao,
    l.created_at,
    l.updated_at
   FROM (lens_catalog.lentes l
     LEFT JOIN lens_catalog.marcas m ON ((l.marca_id = m.id)))
  WHERE (l.status = 'ativo'::lens_catalog.status_lente)
  ORDER BY l.created_at DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| public       | vw_stats_catalogo                |  SELECT ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL))) AS total_lentes,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.grupo_canonico_id IS NOT NULL))) AS lentes_genericas,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.categoria = 'economica'::lens_catalog.categoria_lente))) AS lentes_economicas,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.categoria = 'intermediaria'::lens_catalog.categoria_lente))) AS lentes_intermediarias,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.categoria = 'premium'::lens_catalog.categoria_lente))) AS lentes_premium,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.categoria = 'super_premium'::lens_catalog.categoria_lente))) AS lentes_super_premium,
    ( SELECT count(*) AS count
           FROM lens_catalog.grupos_canonicos
          WHERE (grupos_canonicos.ativo = true)) AS grupos_genericos,
    ( SELECT count(*) AS count
           FROM lens_catalog.grupos_canonicos
          WHERE ((grupos_canonicos.ativo = true) AND (grupos_canonicos.is_premium = false))) AS grupos_standard,
    ( SELECT count(*) AS count
           FROM lens_catalog.grupos_canonicos
          WHERE ((grupos_canonicos.ativo = true) AND (grupos_canonicos.is_premium = true))) AS grupos_premium,
    ( SELECT count(*) AS count
           FROM lens_catalog.marcas
          WHERE (marcas.ativo = true)) AS total_marcas,
    ( SELECT count(*) AS count
           FROM lens_catalog.marcas
          WHERE ((marcas.ativo = true) AND (marcas.is_premium = false))) AS marcas_standard,
    ( SELECT count(*) AS count
           FROM lens_catalog.marcas
          WHERE ((marcas.ativo = true) AND (marcas.is_premium = true))) AS marcas_premium,
    ( SELECT count(*) AS count
           FROM core.fornecedores
          WHERE (fornecedores.ativo = true)) AS total_fornecedores,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_antirreflexo = true))) AS total_com_ar,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_blue_light = true))) AS total_com_blue,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_fotossensiveis IS NOT NULL) AND (lentes.tratamento_fotossensiveis <> 'nenhum'::lens_catalog.tratamento_foto))) AS total_fotossensiveis,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_uv = true))) AS total_uv400,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_antirrisco = true))) AS total_antirrisco,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_fotossensiveis = 'transitions'::lens_catalog.tratamento_foto))) AS total_transitions,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_fotossensiveis = 'fotocromático'::lens_catalog.tratamento_foto))) AS total_fotocromatico,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tratamento_fotossensiveis = 'polarizado'::lens_catalog.tratamento_foto))) AS total_polarizado,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tipo_lente = 'visao_simples'::lens_catalog.tipo_lente))) AS total_visao_simples,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tipo_lente = 'multifocal'::lens_catalog.tipo_lente))) AS total_multifocal,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tipo_lente = 'bifocal'::lens_catalog.tipo_lente))) AS total_bifocal,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tipo_lente = 'leitura'::lens_catalog.tipo_lente))) AS total_leitura,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.tipo_lente = 'ocupacional'::lens_catalog.tipo_lente))) AS total_ocupacional,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.material = 'CR39'::lens_catalog.material_lente))) AS total_cr39,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.material = 'POLICARBONATO'::lens_catalog.material_lente))) AS total_policarbonato,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.material = 'TRIVEX'::lens_catalog.material_lente))) AS total_trivex,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.material = 'HIGH_INDEX'::lens_catalog.material_lente))) AS total_high_index,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.material = 'VIDRO'::lens_catalog.material_lente))) AS total_vidro,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.material = 'ACRILICO'::lens_catalog.material_lente))) AS total_acrilico,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.indice_refracao = '1.50'::lens_catalog.indice_refracao))) AS total_indice_150,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.indice_refracao = '1.56'::lens_catalog.indice_refracao))) AS total_indice_156,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.indice_refracao = '1.59'::lens_catalog.indice_refracao))) AS total_indice_159,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.indice_refracao = '1.61'::lens_catalog.indice_refracao))) AS total_indice_161,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.indice_refracao = '1.67'::lens_catalog.indice_refracao))) AS total_indice_167,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.indice_refracao = '1.74'::lens_catalog.indice_refracao))) AS total_indice_174,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.indice_refracao = '1.90'::lens_catalog.indice_refracao))) AS total_indice_190,
    ( SELECT min(lentes.preco_venda_sugerido) AS min
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL))) AS preco_minimo_catalogo,
    ( SELECT max(lentes.preco_venda_sugerido) AS max
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL))) AS preco_maximo_catalogo,
    ( SELECT round(avg(lentes.preco_venda_sugerido), 2) AS round
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL))) AS preco_medio_catalogo,
    ( SELECT percentile_cont((0.5)::double precision) WITHIN GROUP (ORDER BY ((lentes.preco_venda_sugerido)::double precision)) AS percentile_cont
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL))) AS preco_mediano_catalogo,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.preco_venda_sugerido < (500)::numeric))) AS faixa_economica,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.preco_venda_sugerido >= (500)::numeric) AND (lentes.preco_venda_sugerido < (1500)::numeric))) AS faixa_intermediaria,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.preco_venda_sugerido >= (1500)::numeric) AND (lentes.preco_venda_sugerido < (3000)::numeric))) AS faixa_premium,
    ( SELECT count(*) AS count
           FROM lens_catalog.lentes
          WHERE ((lentes.ativo = true) AND (lentes.deleted_at IS NULL) AND (lentes.preco_venda_sugerido >= (3000)::numeric))) AS faixa_ultra_premium; |
| vault        | decrypted_secrets                | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |


-- Functions/Stored Procedures
SELECT 
    n.nspname as schema,
    p.proname as function_nome,
    pg_get_function_arguments(p.oid) as parametros,
    pg_get_function_result(p.oid) as retorno
FROM pg_proc p
JOIN pg_namespace n ON p.pronamespace = n.oid
WHERE n.nspname NOT IN ('pg_catalog', 'information_schema')
ORDER BY n.nspname, p.proname;

| schema         | function_nome                         | parametros                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | retorno                                                                                                                                                                                                                                                                                                                         |
| -------------- | ------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| auth           | email                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | text                                                                                                                                                                                                                                                                                                                            |
| auth           | jwt                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | jsonb                                                                                                                                                                                                                                                                                                                           |
| auth           | role                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | text                                                                                                                                                                                                                                                                                                                            |
| auth           | uid                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| compras        | atualizar_valor_total_pedido          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| compras        | criar_movimentacao_recebimento        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| compras        | update_pedidos_timestamp              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| core           | update_fornecedores_timestamp         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| extensions     | armor                                 | bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | armor                                 | bytea, text[], text[]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | crypt                                 | text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | dearmor                               | text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | decrypt                               | bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | decrypt_iv                            | bytea, bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | digest                                | text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | digest                                | bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | encrypt                               | bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | encrypt_iv                            | bytea, bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | gen_random_bytes                      | integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | gen_random_uuid                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | gen_salt                              | text, integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | gen_salt                              | text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | grant_pg_cron_access                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | event_trigger                                                                                                                                                                                                                                                                                                                   |
| extensions     | grant_pg_graphql_access               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | event_trigger                                                                                                                                                                                                                                                                                                                   |
| extensions     | grant_pg_net_access                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | event_trigger                                                                                                                                                                                                                                                                                                                   |
| extensions     | hmac                                  | text, text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | hmac                                  | bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pg_stat_statements                    | showtext boolean, OUT userid oid, OUT dbid oid, OUT toplevel boolean, OUT queryid bigint, OUT query text, OUT plans bigint, OUT total_plan_time double precision, OUT min_plan_time double precision, OUT max_plan_time double precision, OUT mean_plan_time double precision, OUT stddev_plan_time double precision, OUT calls bigint, OUT total_exec_time double precision, OUT min_exec_time double precision, OUT max_exec_time double precision, OUT mean_exec_time double precision, OUT stddev_exec_time double precision, OUT rows bigint, OUT shared_blks_hit bigint, OUT shared_blks_read bigint, OUT shared_blks_dirtied bigint, OUT shared_blks_written bigint, OUT local_blks_hit bigint, OUT local_blks_read bigint, OUT local_blks_dirtied bigint, OUT local_blks_written bigint, OUT temp_blks_read bigint, OUT temp_blks_written bigint, OUT shared_blk_read_time double precision, OUT shared_blk_write_time double precision, OUT local_blk_read_time double precision, OUT local_blk_write_time double precision, OUT temp_blk_read_time double precision, OUT temp_blk_write_time double precision, OUT wal_records bigint, OUT wal_fpi bigint, OUT wal_bytes numeric, OUT jit_functions bigint, OUT jit_generation_time double precision, OUT jit_inlining_count bigint, OUT jit_inlining_time double precision, OUT jit_optimization_count bigint, OUT jit_optimization_time double precision, OUT jit_emission_count bigint, OUT jit_emission_time double precision, OUT jit_deform_count bigint, OUT jit_deform_time double precision, OUT stats_since timestamp with time zone, OUT minmax_stats_since timestamp with time zone | SETOF record                                                                                                                                                                                                                                                                                                                    |
| extensions     | pg_stat_statements_info               | OUT dealloc bigint, OUT stats_reset timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | record                                                                                                                                                                                                                                                                                                                          |
| extensions     | pg_stat_statements_reset              | userid oid DEFAULT 0, dbid oid DEFAULT 0, queryid bigint DEFAULT 0, minmax_only boolean DEFAULT false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | timestamp with time zone                                                                                                                                                                                                                                                                                                        |
| extensions     | pgp_armor_headers                     | text, OUT key text, OUT value text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | SETOF record                                                                                                                                                                                                                                                                                                                    |
| extensions     | pgp_key_id                            | bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | pgp_pub_decrypt                       | bytea, bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | pgp_pub_decrypt                       | bytea, bytea, text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | pgp_pub_decrypt                       | bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | pgp_pub_decrypt_bytea                 | bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_pub_decrypt_bytea                 | bytea, bytea, text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_pub_decrypt_bytea                 | bytea, bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_pub_encrypt                       | text, bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_pub_encrypt                       | text, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_pub_encrypt_bytea                 | bytea, bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_pub_encrypt_bytea                 | bytea, bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_sym_decrypt                       | bytea, text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | pgp_sym_decrypt                       | bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | text                                                                                                                                                                                                                                                                                                                            |
| extensions     | pgp_sym_decrypt_bytea                 | bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_sym_decrypt_bytea                 | bytea, text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_sym_encrypt                       | text, text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_sym_encrypt                       | text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_sym_encrypt_bytea                 | bytea, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgp_sym_encrypt_bytea                 | bytea, text, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | bytea                                                                                                                                                                                                                                                                                                                           |
| extensions     | pgrst_ddl_watch                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | event_trigger                                                                                                                                                                                                                                                                                                                   |
| extensions     | pgrst_drop_watch                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | event_trigger                                                                                                                                                                                                                                                                                                                   |
| extensions     | set_graphql_placeholder               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | event_trigger                                                                                                                                                                                                                                                                                                                   |
| extensions     | uuid_generate_v1                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_generate_v1mc                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_generate_v3                      | namespace uuid, name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_generate_v4                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_generate_v5                      | namespace uuid, name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_nil                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_ns_dns                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_ns_oid                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_ns_url                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_ns_x500                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | uuid                                                                                                                                                                                                                                                                                                                            |
| graphql        | _internal_resolve                     | query text, variables jsonb DEFAULT '{}'::jsonb, "operationName" text DEFAULT NULL::text, extensions jsonb DEFAULT NULL::jsonb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | jsonb                                                                                                                                                                                                                                                                                                                           |
| graphql        | comment_directive                     | comment_ text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | jsonb                                                                                                                                                                                                                                                                                                                           |
| graphql        | exception                             | message text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | text                                                                                                                                                                                                                                                                                                                            |
| graphql        | get_schema_version                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | integer                                                                                                                                                                                                                                                                                                                         |
| graphql        | increment_schema_version              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | event_trigger                                                                                                                                                                                                                                                                                                                   |
| graphql        | resolve                               | query text, variables jsonb DEFAULT '{}'::jsonb, "operationName" text DEFAULT NULL::text, extensions jsonb DEFAULT NULL::jsonb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | jsonb                                                                                                                                                                                                                                                                                                                           |
| graphql_public | graphql                               | "operationName" text DEFAULT NULL::text, query text DEFAULT NULL::text, variables jsonb DEFAULT NULL::jsonb, extensions jsonb DEFAULT NULL::jsonb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | jsonb                                                                                                                                                                                                                                                                                                                           |
| lens_catalog   | atualizar_estatisticas_grupo_manual   | p_grupo_id uuid DEFAULT NULL::uuid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | TABLE(id uuid, nome_grupo text, total_lentes integer, total_marcas integer, preco_minimo numeric, preco_maximo numeric, preco_medio numeric)                                                                                                                                                                                    |
| lens_catalog   | fn_associar_lente_grupo_automatico    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | fn_atualizar_estatisticas_grupo       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | fn_auditar_grupos                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | fn_criar_grupo_canonico_automatico    | p_tipo_lente text, p_material text, p_indice_refracao text, p_grau_esferico_min numeric, p_grau_esferico_max numeric, p_grau_cilindrico_min numeric, p_grau_cilindrico_max numeric, p_adicao_min numeric DEFAULT NULL::numeric, p_adicao_max numeric DEFAULT NULL::numeric                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | uuid                                                                                                                                                                                                                                                                                                                            |
| lens_catalog   | generate_lente_slug                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | update_canonicas_timestamp            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | update_grupos_timestamp               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | update_lentes_timestamp               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | update_marcas_timestamp               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | update_premium_timestamp              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| lens_catalog   | validar_integridade_grupos            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | TABLE(grupo_id uuid, nome_grupo text, problema text, total_lentes_registrado integer, total_lentes_real integer, preco_medio_registrado numeric, preco_medio_real numeric)                                                                                                                                                      |
| pgbouncer      | get_auth                              | p_usename text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | TABLE(username text, password text)                                                                                                                                                                                                                                                                                             |
| public         | buscar_lentes                         | p_tipo_lente lens_catalog.tipo_lente DEFAULT NULL::lens_catalog.tipo_lente, p_material lens_catalog.material_lente DEFAULT NULL::lens_catalog.material_lente, p_indice lens_catalog.indice_refracao DEFAULT NULL::lens_catalog.indice_refracao, p_preco_min numeric DEFAULT NULL::numeric, p_preco_max numeric DEFAULT NULL::numeric, p_tem_ar boolean DEFAULT NULL::boolean, p_tem_blue boolean DEFAULT NULL::boolean, p_fornecedor_id uuid DEFAULT NULL::uuid, p_marca_id uuid DEFAULT NULL::uuid, p_limit integer DEFAULT 50, p_offset integer DEFAULT 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | TABLE(id uuid, slug text, nome text, fornecedor text, marca text, tipo_lente lens_catalog.tipo_lente, material lens_catalog.material_lente, indice_refracao lens_catalog.indice_refracao, preco numeric, categoria lens_catalog.categoria_lente, tem_ar boolean, tem_blue boolean, grupo_nome text, estoque_disponivel integer) |
| public         | buscar_lentes_por_receita             | p_esferico numeric, p_cilindrico numeric, p_adicao numeric DEFAULT NULL::numeric, p_tipo_lente text DEFAULT NULL::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | SETOF vw_lentes_catalogo                                                                                                                                                                                                                                                                                                        |
| public         | obter_alternativas_lente              | p_lente_id uuid, p_limit integer DEFAULT 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | TABLE(id uuid, slug text, nome text, fornecedor text, preco numeric, diferenca_preco numeric, prazo_dias integer)                                                                                                                                                                                                               |
| public         | unaccent                              | regdictionary, text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | text                                                                                                                                                                                                                                                                                                                            |
| public         | unaccent                              | text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | text                                                                                                                                                                                                                                                                                                                            |
| public         | unaccent_init                         | internal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | internal                                                                                                                                                                                                                                                                                                                        |
| public         | unaccent_lexize                       | internal, internal, internal, internal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | internal                                                                                                                                                                                                                                                                                                                        |
| realtime       | apply_rls                             | wal jsonb, max_record_bytes integer DEFAULT (1024 * 1024)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | SETOF realtime.wal_rls                                                                                                                                                                                                                                                                                                          |
| realtime       | broadcast_changes                     | topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text DEFAULT 'ROW'::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | void                                                                                                                                                                                                                                                                                                                            |
| realtime       | build_prepared_statement_sql          | prepared_statement_name text, entity regclass, columns realtime.wal_column[]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | text                                                                                                                                                                                                                                                                                                                            |
| realtime       | cast                                  | val text, type_ regtype                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | jsonb                                                                                                                                                                                                                                                                                                                           |
| realtime       | check_equality_op                     | op realtime.equality_op, type_ regtype, val_1 text, val_2 text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | boolean                                                                                                                                                                                                                                                                                                                         |
| realtime       | is_visible_through_filters            | columns realtime.wal_column[], filters realtime.user_defined_filter[]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | boolean                                                                                                                                                                                                                                                                                                                         |
| realtime       | list_changes                          | publication name, slot_name name, max_changes integer, max_record_bytes integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | SETOF realtime.wal_rls                                                                                                                                                                                                                                                                                                          |
| realtime       | quote_wal2json                        | entity regclass                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | text                                                                                                                                                                                                                                                                                                                            |
| realtime       | send                                  | payload jsonb, event text, topic text, private boolean DEFAULT true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | void                                                                                                                                                                                                                                                                                                                            |
| realtime       | subscription_check_filters            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| realtime       | to_regrole                            | role_name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | regrole                                                                                                                                                                                                                                                                                                                         |
| realtime       | topic                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | text                                                                                                                                                                                                                                                                                                                            |
| storage        | add_prefixes                          | _bucket_id text, _name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | void                                                                                                                                                                                                                                                                                                                            |
| storage        | can_insert_object                     | bucketid text, name text, owner uuid, metadata jsonb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | void                                                                                                                                                                                                                                                                                                                            |
| storage        | delete_leaf_prefixes                  | bucket_ids text[], names text[]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | void                                                                                                                                                                                                                                                                                                                            |
| storage        | delete_prefix                         | _bucket_id text, _name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | boolean                                                                                                                                                                                                                                                                                                                         |
| storage        | delete_prefix_hierarchy_trigger       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | enforce_bucket_name_length            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | extension                             | name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | text                                                                                                                                                                                                                                                                                                                            |
| storage        | filename                              | name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | text                                                                                                                                                                                                                                                                                                                            |
| storage        | foldername                            | name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | text[]                                                                                                                                                                                                                                                                                                                          |
| storage        | get_level                             | name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | integer                                                                                                                                                                                                                                                                                                                         |
| storage        | get_prefix                            | name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | text                                                                                                                                                                                                                                                                                                                            |
| storage        | get_prefixes                          | name text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | text[]                                                                                                                                                                                                                                                                                                                          |
| storage        | get_size_by_bucket                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | TABLE(size bigint, bucket_id text)                                                                                                                                                                                                                                                                                              |
| storage        | list_multipart_uploads_with_delimiter | bucket_id text, prefix_param text, delimiter_param text, max_keys integer DEFAULT 100, next_key_token text DEFAULT ''::text, next_upload_token text DEFAULT ''::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | TABLE(key text, id text, created_at timestamp with time zone)                                                                                                                                                                                                                                                                   |
| storage        | list_objects_with_delimiter           | bucket_id text, prefix_param text, delimiter_param text, max_keys integer DEFAULT 100, start_after text DEFAULT ''::text, next_token text DEFAULT ''::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | TABLE(name text, id uuid, metadata jsonb, updated_at timestamp with time zone)                                                                                                                                                                                                                                                  |
| storage        | lock_top_prefixes                     | bucket_ids text[], names text[]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | void                                                                                                                                                                                                                                                                                                                            |
| storage        | objects_delete_cleanup                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | objects_insert_prefix_trigger         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | objects_update_cleanup                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | objects_update_level_trigger          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | objects_update_prefix_trigger         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | operation                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | text                                                                                                                                                                                                                                                                                                                            |
| storage        | prefixes_delete_cleanup               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | prefixes_insert_trigger               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| storage        | search                                | prefix text, bucketname text, limits integer DEFAULT 100, levels integer DEFAULT 1, offsets integer DEFAULT 0, search text DEFAULT ''::text, sortcolumn text DEFAULT 'name'::text, sortorder text DEFAULT 'asc'::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | TABLE(name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)                                                                                                                                                                  |
| storage        | search_legacy_v1                      | prefix text, bucketname text, limits integer DEFAULT 100, levels integer DEFAULT 1, offsets integer DEFAULT 0, search text DEFAULT ''::text, sortcolumn text DEFAULT 'name'::text, sortorder text DEFAULT 'asc'::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | TABLE(name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)                                                                                                                                                                  |
| storage        | search_v1_optimised                   | prefix text, bucketname text, limits integer DEFAULT 100, levels integer DEFAULT 1, offsets integer DEFAULT 0, search text DEFAULT ''::text, sortcolumn text DEFAULT 'name'::text, sortorder text DEFAULT 'asc'::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | TABLE(name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)                                                                                                                                                                  |
| storage        | search_v2                             | prefix text, bucket_name text, limits integer DEFAULT 100, levels integer DEFAULT 1, start_after text DEFAULT ''::text, sort_order text DEFAULT 'asc'::text, sort_column text DEFAULT 'name'::text, sort_column_after text DEFAULT ''::text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | TABLE(key text, name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)                                                                                                                                                        |
| storage        | update_updated_at_column              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | trigger                                                                                                                                                                                                                                                                                                                         |
| vault          | _crypto_aead_det_decrypt              | message bytea, additional bytea, key_id bigint, context bytea DEFAULT '\x7067736f6469756d'::bytea, nonce bytea DEFAULT NULL::bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | bytea                                                                                                                                                                                                                                                                                                                           |
| vault          | _crypto_aead_det_encrypt              | message bytea, additional bytea, key_id bigint, context bytea DEFAULT '\x7067736f6469756d'::bytea, nonce bytea DEFAULT NULL::bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | bytea                                                                                                                                                                                                                                                                                                                           |
| vault          | _crypto_aead_det_noncegen             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | bytea                                                                                                                                                                                                                                                                                                                           |
| vault          | create_secret                         | new_secret text, new_name text DEFAULT NULL::text, new_description text DEFAULT ''::text, new_key_id uuid DEFAULT NULL::uuid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | uuid                                                                                                                                                                                                                                                                                                                            |
| vault          | update_secret                         | secret_id uuid, new_secret text DEFAULT NULL::text, new_name text DEFAULT NULL::text, new_description text DEFAULT NULL::text, new_key_id uuid DEFAULT NULL::uuid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | void                                                                                                                                                                                                                                                                                                                            |


-- ============================================================================
-- NOTAS PARA PREENCHER APÓS EXECUÇÃO:
-- ============================================================================
-- [ ] Quantos schemas encontrados?
-- [ ] Qual o schema principal das lentes?
-- [ ] Nome correto da tabela de lentes:
-- [ ] Nome correto da tabela de laboratórios:
-- [ ] Nome correto da tabela de fornecedores (se houver):
-- [ ] Existem views? Quais?
-- [ ] Existem stored procedures? Quais?
-- [ ] Total de registros em cada tabela principal:
