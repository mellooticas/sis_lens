-- ===============================================================
-- üé® CURADORIA DO "MUSEU" (INVESTIGA√á√ÉO PROFUNDA DO SCHEMA PUBLIC)
-- ===============================================================
-- Objetivo: Validar se o schema 'public' (acess√≠vel ao Frontend) 
-- possui todas as views e dados necess√°rios para a interface.
-- Vamos ignorar as estat√≠sticas e contar os dados reais.

-- 1. üë• CLIENTES E LOJAS (Estrutura B√°sica do CRM/Vendas)
-- O frontend precisa listar clientes e lojas para iniciar uma venda.
SELECT 'public.clientes' as tabela, count(*) as qtd FROM public.clientes
UNION ALL
SELECT 'public.lojas', count(*) FROM public.lojas; n√£o vmaos usar nada de lojas aqui, este banco n√£o √© para vender ou comprar nada, apenas para cruzamneto e melhores op√ß√£o de ceomporas de lentes e vendas para o cliente, ser√° referencia para o pdv e compra de lentes, ok

| tabela          | qtd |
| --------------- | --- |
| public.clientes | 29  |
| public.lojas    | 2   |


-- üîç DETALHE: O que tem na tabela clientes?
-- O frontend precisa de: Nome, Documento, Telefone, Email.
SELECT id, nome, documento, telefone, email, user_id 
FROM public.clientes 
LIMIT 5;

-- üîç DETALHE: O que tem na tabela lojas?
-- O frontend precisa de: Nome, Endere√ßo, Slug (se houver).
SELECT id, nome, endereco_completo, tenant_id 
FROM public.lojas 
LIMIT 5;

-- 2. üëì CAT√ÅLOGO DE PRODUTOS (Vis√£o do Frontend)
-- O frontend geralmente consome 'vw_lentes_catalogo' ou 'vw_todas_lentes'.
-- Vamos ver qual est√° melhor estruturada.
SELECT 'public.vw_lentes_catalogo' as view, count(*) as qtd FROM public.vw_lentes_catalogo;

| view                      | qtd |
| ------------------------- | --- |
| public.vw_lentes_catalogo | 2   |


-- üßê AN√ÅLISE DA VIEW 'vw_lentes_catalogo':
-- Verifique se traz: Pre√ßo, Nome Descritivo, Faixa de Grau (esf√©rico/cil√≠ndrico).
SELECT * FROM public.vw_lentes_catalogo LIMIT 5;

| lente_id                             | sku_canonico           | marca_nome | familia    | design       | tipo_lente  | indice_refracao | descricao_completa                    | tenant_id                            |
| ------------------------------------ | ---------------------- | ---------- | ---------- | ------------ | ----------- | --------------- | ------------------------------------- | ------------------------------------ |
| 64142638-46c3-44f7-a100-6bd12b1f76f6 | LENS-9001-SIS-GOLD-167 | SIS Lens   | SIS Gold   | Digital HD   | PROGRESSIVA | 1.67            | SIS Lens SIS Gold Digital HD 1.67     | 229220bb-d480-4608-a07c-ae9ab5266caf |
| 4a8803e9-7f99-42ec-9084-9192f508f085 | LENS-9002-SIS-SILV-159 | SIS Lens   | SIS Silver | Digital Soft | PROGRESSIVA | 1.59            | SIS Lens SIS Silver Digital Soft 1.59 | 229220bb-d480-4608-a07c-ae9ab5266caf |


-- 3. üè≠ FORNECEDORES E RANKING (Vis√£o de Decis√£o)
-- O frontend precisa mostrar "Laborat√≥rios Dispon√≠veis".
SELECT * FROM public.vw_fornecedores_disponiveis LIMIT 10;

-- üèÜ AN√ÅLISE DO RANKING (Se existir view p√∫blica):
-- Verifique se existe uma view em public que j√° traz os scores calculados.
-- Caso contr√°rio, o frontend teria que chamar 'api.obter_laboratorio' um a um?
SELECT * FROM public.vw_ranking_opcoes LIMIT 5;

-- 4. üõí DECIS√ïES DE COMPRA (Hist√≥rico e Dashboard)
-- O usuario quer ver as decis√µes que j√° tomou.
SELECT * FROM public.decisoes_compra LIMIT 5;

-- 5. ‚öôÔ∏è CONFIGURA√á√ïES GERAIS
-- Parametriza√ß√µes do sistema que o front precisa carregar no boot.
SELECT * FROM public.configuracoes;

| id                                   | chave                         | valor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | descricao                                                        | ativo | created_at                    | updated_at                    |
| ------------------------------------ | ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ----- | ----------------------------- | ----------------------------- |
| e0db8473-290a-4335-b3f8-05e7c9c5d7a0 | app_name                      | BestLens                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Nome da aplica√ß√£o                                                | true  | 2025-10-03 14:52:22.259782+00 | 2025-10-03 14:52:22.259782+00 |
| 8d2904d0-e9fd-41fc-88d7-95c210288b8f | app_version                   | 1.0.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Vers√£o atual                                                     | true  | 2025-10-03 14:52:22.259782+00 | 2025-10-03 14:52:22.259782+00 |
| 7120f7b8-4277-46d6-92c5-523645ee0c53 | max_ranking_results           | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | M√°ximo de resultados no ranking                                  | true  | 2025-10-03 14:52:22.259782+00 | 2025-10-03 14:52:22.259782+00 |
| 235539b4-333f-4a9b-a014-4474fec4ad77 | default_criterio              | NORMAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Crit√©rio padr√£o para decis√µes                                    | true  | 2025-10-03 14:52:22.259782+00 | 2025-10-03 14:52:22.259782+00 |
| e2aa929a-80e6-4b54-b0d0-021731eeea0a | sistema_ativo                 | true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Sistema ativo para novos usu√°rios                                | true  | 2025-10-03 14:52:22.259782+00 | 2025-10-03 14:52:22.259782+00 |
| 5f2a1d40-464b-408e-87b9-46d6ad805c74 | migracao_sis_vision           | em_andamento                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Status da migra√ß√£o dos dados do SIS_Vision                       | true  | 2025-10-09 05:12:57.654501+00 | 2025-10-09 05:12:57.654501+00 |
| 3b101fb3-8e7e-4205-9a1c-bf5692b20788 | sis_vision_lentes_total       | 265                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Total de lentes dispon√≠veis no SIS_Vision                        | true  | 2025-10-09 05:12:57.703385+00 | 2025-10-09 05:12:57.703385+00 |
| 5a378d8a-3626-40e2-a43b-4db03456d326 | sis_vision_fornecedores_total | 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Total de fornecedores √∫nicos no SIS_Vision                       | true  | 2025-10-09 05:12:57.736119+00 | 2025-10-09 05:12:57.736119+00 |
| 8934f030-df15-4db9-a2e5-68b996dd201f | migracao_marcas_principais    | ["GENERICA"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Principais marcas identificadas para migra√ß√£o                    | true  | 2025-10-09 05:12:57.764614+00 | 2025-10-09 05:12:57.764614+00 |
| 068b845b-ef68-4ce9-bc10-58b64dd7a38f | migracao_status               | em_andamento                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Status atual da migra√ß√£o de dados                                | true  | 2025-10-09 05:12:57.793787+00 | 2025-10-09 05:12:57.793787+00 |
| 5413497c-1ddc-4807-9b86-0ef155806a53 | lente_LVN000077               | {"marca":"GENERICA","tipo":"VISAO SIMPLES","material":"CR-39","indice":"1.49"}                                                                                                                                                                                                                                                                                                                                                                                                              | Configura√ß√£o da lente LensVision Monofocal CR39 1.49 Tint        | true  | 2025-10-09 05:14:08.029936+00 | 2025-10-09 05:14:08.029936+00 |
| 6a358d2e-d219-4aab-abd4-a276a6c46779 | lente_LVN000097               | {"marca":"GENERICA","tipo":"VISAO SIMPLES","material":"POLICARBONATO","indice":"1.59"}                                                                                                                                                                                                                                                                                                                                                                                                      | Configura√ß√£o da lente LensVision Monofocal Policarbonato 1.59    | true  | 2025-10-09 05:14:08.029936+00 | 2025-10-09 05:14:08.029936+00 |
| 5bfa1ec3-fdc6-4d69-8de7-222bb02bbe98 | lente_LVN000082               | {"marca":"GENERICA","tipo":"VISAO SIMPLES","material":"RESINA","indice":"1.56"}                                                                                                                                                                                                                                                                                                                                                                                                             | Configura√ß√£o da lente LensVision Monofocal Resina 1.56 AR        | true  | 2025-10-09 05:14:08.029936+00 | 2025-10-09 05:14:08.029936+00 |
| 8f8f446a-8062-4857-8095-ab7d0fefe081 | lente_LVN000002               | {"marca":"GENERICA","tipo":"VISAO SIMPLES","material":"CR-39","indice":"1.49"}                                                                                                                                                                                                                                                                                                                                                                                                              | Configura√ß√£o da lente LensVision Monofocal CR39 1.49 Tint        | true  | 2025-10-09 05:14:08.029936+00 | 2025-10-09 05:14:08.029936+00 |
| 49a2c52b-09df-4b59-8cb2-b45303e4440f | lente_LVN000058               | {"marca":"GENERICA","tipo":"VISAO SIMPLES","material":"CR-39","indice":"1.56"}                                                                                                                                                                                                                                                                                                                                                                                                              | Configura√ß√£o da lente LensVision Monofocal CR39 1.56 AR          | true  | 2025-10-09 05:14:08.029936+00 | 2025-10-09 05:14:08.029936+00 |
| b44313db-90a7-4a08-a15a-1ed42b7882d7 | catalogo_completo_sis_vision  | {"total_lentes":265,"marcas":["GENERICA"],"tipos":["VISAO SIMPLES","MULTIFOCAL","BIFOCAL","FREE FORM"],"materiais":["CR-39","POLICARBONATO","RESINA"],"data_migracacao":"2025-10-09T05:15:10.016Z"}                                                                                                                                                                                                                                                                                         | Cat√°logo completo migrado do SIS_Vision                          | true  | 2025-10-09 05:15:10.29744+00  | 2025-10-09 05:15:10.29744+00  |
| 7bbe7a28-d76c-4273-acca-caf3eaa25d9c | fornecedores_sis_vision       | ["Express","Sygma","Polylux","Brascor","So Blocos"]                                                                                                                                                                                                                                                                                                                                                                                                                                         | Lista completa de fornecedores do SIS_Vision                     | true  | 2025-10-09 05:15:10.367119+00 | 2025-10-09 05:15:10.367119+00 |
| e86263c3-eb12-4a1d-bf45-a70323f4895f | estatisticas_migracao         | {"total_lentes":265,"total_marcas":1,"total_fornecedores":5,"tipos_lente":["VISAO SIMPLES","MULTIFOCAL","BIFOCAL","FREE FORM"],"materiais_disponiveis":["CR-39","POLICARBONATO","RESINA"],"preco_medio_geral":583.6395471698114}                                                                                                                                                                                                                                                            | Estat√≠sticas completas da migra√ß√£o                               | true  | 2025-10-09 05:15:10.40796+00  | 2025-10-09 05:15:10.40796+00  |
| 19785f07-66e2-4cc0-a5b4-58a0c33b7049 | lente_catalogo_LVN000077      | {"id":"cb58aef1-9bf9-4593-98b2-a0060649b7df","sku_canonico":"LVN000077","familia":"Lente LensVision Monofocal CR39 1.49 Tint","design":"Standard","material":"CR-39","indice_refracao":1.49,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal CR39 1.49 Tint","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":18.38,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}                  | Lente do cat√°logo: Lente LensVision Monofocal CR39 1.49 Tint     | true  | 2025-10-09 05:25:05.993373+00 | 2025-10-09 05:25:05.993373+00 |
| 744bfc29-1d66-4003-9fe7-a0ecd2d9858a | lente_catalogo_LVN000097      | {"id":"232ca17c-04fe-4804-8f8d-6632c775e8ad","sku_canonico":"LVN000097","familia":"Lente LensVision Monofocal Policarbonato 1.59","design":"Standard","material":"POLICARBONATO","indice_refracao":1.59,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal Policarbonato 1.59","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":344.45,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"} | Lente do cat√°logo: Lente LensVision Monofocal Policarbonato 1.59 | true  | 2025-10-09 05:25:06.06046+00  | 2025-10-09 05:25:06.06046+00  |
| e45283c7-18f6-4e24-b2d1-4cfc2be816c9 | lente_catalogo_LVN000082      | {"id":"4dc01cf8-38aa-4704-8186-055c026b0412","sku_canonico":"LVN000082","familia":"Lente LensVision Monofocal Resina 1.56 AR","design":"Standard","material":"RESINA","indice_refracao":1.56,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal Resina 1.56 AR","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":31.53,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}                 | Lente do cat√°logo: Lente LensVision Monofocal Resina 1.56 AR     | true  | 2025-10-09 05:25:06.095351+00 | 2025-10-09 05:25:06.095351+00 |
| e8eba92d-70b1-46e1-b51a-48d5cd964dfa | lente_catalogo_LVN000002      | {"id":"1e18045e-0e1b-49c9-a24a-28cf030b781e","sku_canonico":"LVN000002","familia":"Lente LensVision Monofocal CR39 1.49 Tint","design":"Standard","material":"CR-39","indice_refracao":1.49,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal CR39 1.49 Tint","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":10.5,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}                   | Lente do cat√°logo: Lente LensVision Monofocal CR39 1.49 Tint     | true  | 2025-10-09 05:25:06.147968+00 | 2025-10-09 05:25:06.147968+00 |
| f0da8899-728c-46f3-be6e-bc8c7638acd3 | lente_catalogo_LVN000058      | {"id":"7f457036-3c21-4e19-855a-55c70dad505e","sku_canonico":"LVN000058","familia":"Lente LensVision Monofocal CR39 1.56 AR","design":"Standard","material":"CR-39","indice_refracao":1.56,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal CR39 1.56 AR","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":39.48,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}                      | Lente do cat√°logo: Lente LensVision Monofocal CR39 1.56 AR       | true  | 2025-10-09 05:25:06.187069+00 | 2025-10-09 05:25:06.187069+00 |
| fdd9baa8-2331-46ad-9826-9b7a435bf42b | lente_catalogo_LVN000172      | {"id":"975e8d61-4597-41fd-8af9-15b72919d264","sku_canonico":"LVN000172","familia":"Lente LensVision Monofocal CR39 1.56 Tint","design":"Standard","material":"CR-39","indice_refracao":1.56,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal CR39 1.56 Tint","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":17.5,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}                   | Lente do cat√°logo: Lente LensVision Monofocal CR39 1.56 Tint     | true  | 2025-10-09 05:25:06.281277+00 | 2025-10-09 05:25:06.281277+00 |
| 41c04a04-95e9-421d-8b09-f1e9dae5434a | lente_catalogo_LVN000005      | {"id":"fa66a114-3bde-4c62-99c5-5889730cd7f7","sku_canonico":"LVN000005","familia":"Lente LensVision Monofocal CR39 1.56 AR","design":"Standard","material":"CR-39","indice_refracao":1.56,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal CR39 1.56 AR","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":15,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}                         | Lente do cat√°logo: Lente LensVision Monofocal CR39 1.56 AR       | true  | 2025-10-09 05:25:06.357453+00 | 2025-10-09 05:25:06.357453+00 |
| e551aa29-64b0-428d-afb8-bd952a1823eb | lente_catalogo_LVN000138      | {"id":"fb2b6285-c3a7-4559-a8e0-64b8a551b82a","sku_canonico":"LVN000138","familia":"Lente LensVision Monofocal Resina 1.56 Blue","design":"Standard","material":"RESINA","indice_refracao":1.56,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal Resina 1.56 Blue","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":403.8,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}             | Lente do cat√°logo: Lente LensVision Monofocal Resina 1.56 Blue   | true  | 2025-10-09 05:25:06.390894+00 | 2025-10-09 05:25:06.390894+00 |
| c28167c8-b8b5-4708-a20b-196e62ca691a | lente_catalogo_LVN000090      | {"id":"e9699cc1-da44-49db-adde-7be390146360","sku_canonico":"LVN000090","familia":"Lente LensVision Monofocal CR39 1.49 AR","design":"Standard","material":"CR-39","indice_refracao":1.49,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal CR39 1.49 AR","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":397.1,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}                      | Lente do cat√°logo: Lente LensVision Monofocal CR39 1.49 AR       | true  | 2025-10-09 05:25:06.425378+00 | 2025-10-09 05:25:06.425378+00 |
| 9947861e-c847-4d35-a9fb-0a97924d3d59 | lente_catalogo_LVN000003      | {"id":"75e4ae13-cd40-489d-b7f1-3cb4a33d8e5f","sku_canonico":"LVN000003","familia":"Lente LensVision Monofocal CR39 1.49 AR Tint","design":"Standard","material":"CR-39","indice_refracao":1.49,"tipo_lente":"VISAO SIMPLES","marca_nome":"GENERICA","descricao_completa":"Lente LensVision Monofocal CR39 1.49 AR Tint","tratamentos":{"ar":false,"blue":false,"fotossensivel":false},"preco_base":15.5,"disponibilidade":true,"created_at":"2025-10-09T05:15:10.440033+00:00"}             | Lente do cat√°logo: Lente LensVision Monofocal CR39 1.49 AR Tint  | true  | 2025-10-09 05:25:06.455479+00 | 2025-10-09 05:25:06.455479+00 |



-- 6. ‚ö†Ô∏è CHECAGEM DE INTEGRIDADE (PUBLIC vs LENS_CATALOG)
-- Verificar se a view publica est√° realmente puxando do schema oficial 'lens_catalog'.
-- Se 'lens_catalog.lentes' estiver vazia, a view publica tamb√©m estar√°.
SELECT 'lens_catalog.lentes' as fonte_b, count(*) FROM lens_catalog.lentes;


| fonte_b             | count |
| ------------------- | ----- |
| lens_catalog.lentes | 2     |