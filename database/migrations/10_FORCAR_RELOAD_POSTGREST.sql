-- ============================================
-- 10_FORCAR_RELOAD_POSTGREST.sql
-- Forçar reload completo do PostgREST
-- ============================================

-- Notificar o PostgREST para recarregar TUDO
NOTIFY pgrst, 'reload config';
NOTIFY pgrst, 'reload schema';

-- Aguardar um momento
SELECT pg_sleep(2);

-- Listar schemas disponíveis
SELECT nspname 
FROM pg_namespace 
WHERE nspname NOT IN ('pg_toast', 'pg_catalog', 'information_schema')
ORDER BY nspname;

| nspname          |
| ---------------- |
| auth             |
| extensions       |
| graphql          |
| graphql_public   |
| lens_catalog     |
| pessoas          |
| pg_temp_0        |
| pg_temp_1        |
| pg_temp_10       |
| pg_temp_11       |
| pg_temp_12       |
| pg_temp_13       |
| pg_temp_14       |
| pg_temp_15       |
| pg_temp_16       |
| pg_temp_17       |
| pg_temp_18       |
| pg_temp_19       |
| pg_temp_2        |
| pg_temp_20       |
| pg_temp_21       |
| pg_temp_22       |
| pg_temp_23       |
| pg_temp_24       |
| pg_temp_25       |
| pg_temp_26       |
| pg_temp_27       |
| pg_temp_28       |
| pg_temp_29       |
| pg_temp_3        |
| pg_temp_30       |
| pg_temp_31       |
| pg_temp_32       |
| pg_temp_33       |
| pg_temp_34       |
| pg_temp_35       |
| pg_temp_36       |
| pg_temp_37       |
| pg_temp_38       |
| pg_temp_39       |
| pg_temp_4        |
| pg_temp_40       |
| pg_temp_41       |
| pg_temp_42       |
| pg_temp_43       |
| pg_temp_44       |
| pg_temp_45       |
| pg_temp_46       |
| pg_temp_47       |
| pg_temp_48       |
| pg_temp_49       |
| pg_temp_5        |
| pg_temp_50       |
| pg_temp_51       |
| pg_temp_52       |
| pg_temp_53       |
| pg_temp_54       |
| pg_temp_55       |
| pg_temp_56       |
| pg_temp_57       |
| pg_temp_58       |
| pg_temp_59       |
| pg_temp_6        |
| pg_temp_7        |
| pg_temp_8        |
| pg_temp_9        |
| pg_toast_temp_0  |
| pg_toast_temp_1  |
| pg_toast_temp_10 |
| pg_toast_temp_11 |
| pg_toast_temp_12 |
| pg_toast_temp_13 |
| pg_toast_temp_14 |
| pg_toast_temp_15 |
| pg_toast_temp_16 |
| pg_toast_temp_17 |
| pg_toast_temp_18 |
| pg_toast_temp_19 |
| pg_toast_temp_2  |
| pg_toast_temp_20 |
| pg_toast_temp_21 |
| pg_toast_temp_22 |
| pg_toast_temp_23 |
| pg_toast_temp_24 |
| pg_toast_temp_25 |
| pg_toast_temp_26 |
| pg_toast_temp_27 |
| pg_toast_temp_28 |
| pg_toast_temp_29 |
| pg_toast_temp_3  |
| pg_toast_temp_30 |
| pg_toast_temp_31 |
| pg_toast_temp_32 |
| pg_toast_temp_33 |
| pg_toast_temp_34 |
| pg_toast_temp_35 |
| pg_toast_temp_36 |
| pg_toast_temp_37 |
| pg_toast_temp_38 |
| pg_toast_temp_39 |
| pg_toast_temp_4  |
| pg_toast_temp_40 |
| pg_toast_temp_41 |
| pg_toast_temp_42 |
| pg_toast_temp_43 |
| pg_toast_temp_44 |
| pg_toast_temp_45 |
| pg_toast_temp_46 |
| pg_toast_temp_47 |
| pg_toast_temp_48 |
| pg_toast_temp_49 |
| pg_toast_temp_5  |
| pg_toast_temp_50 |
| pg_toast_temp_51 |
| pg_toast_temp_52 |
| pg_toast_temp_53 |
| pg_toast_temp_54 |
| pg_toast_temp_55 |
| pg_toast_temp_56 |
| pg_toast_temp_57 |
| pg_toast_temp_58 |
| pg_toast_temp_59 |
| pg_toast_temp_6  |
| pg_toast_temp_7  |
| pg_toast_temp_8  |
| pg_toast_temp_9  |
| pgbouncer        |
| public           |
| public_api       |
| realtime         |
| storage          |
| vault            |



-- Verificar se as views estão visíveis para o role anon
SELECT 
    schemaname,
    viewname,
    has_table_privilege('anon', schemaname || '.' || viewname, 'SELECT') as anon_pode_ver
FROM pg_views
WHERE schemaname = 'public'
  AND viewname LIKE 'vw_%'
ORDER BY viewname;


| schemaname | viewname                 | anon_pode_ver |
| ---------- | ------------------------ | ------------- |
| public     | vw_buscar_lentes         | true          |
| public     | vw_comparar_fornecedores | true          |
| public     | vw_filtros_disponiveis   | true          |
| public     | vw_fornecedores          | true          |
| public     | vw_grupos_genericos      | true          |
| public     | vw_grupos_premium        | true          |
| public     | vw_marcas                | true          |
| public     | vw_stats_catalogo        | true          |